/*! p5.sound.js v0.3.7 2018-01-19 */
(function(n,t){typeof define=="function"&&define.amd?define("p5.sound",["p5"],function(n){t(n)}):typeof exports=="object"?t(require("../p5")):t(n.p5)})(this,function(n){var o,t,y,s,ut,ft,et,ot,i,ki,a,di,st,ht,ct,lt,gi,at,w,nr,e,f,u,h,vt,b,yt,c,pt,wt,bt,kt,k,d,g,dt,gt,ni,ti,tr,ii,ri,nt,r,l,tt,ui,fi,ei,oi,si,hi,v,ci,li,ai,vi,yi,pi,wi,p,it,rt,bi,ir;o=function(){var i,t,f,r,u;(function(){function n(n){n&&(n.setTargetAtTime||(n.setTargetAtTime=n.setTargetValueAtTime))}window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=window.webkitAudioContext,typeof AudioContext.prototype.createGain!="function"&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),typeof AudioContext.prototype.createDelay!="function"&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),typeof AudioContext.prototype.createScriptProcessor!="function"&&(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),typeof AudioContext.prototype.createPeriodicWave!="function"&&(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var t=this.internal_createGain();return n(t.gain),t},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(t){var i=t?this.internal_createDelay(t):this.internal_createDelay();return n(i.delayTime),i},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var t=this.internal_createBufferSource();return t.start?(t.internal_start=t.start,t.start=function(n,i,r){typeof r!="undefined"?t.internal_start(n||0,i,r):t.internal_start(n||0,i||0)}):t.start=function(n,t,i){t||i?this.noteGrainOn(n||0,t,i):this.noteOn(n||0)},t.stop?(t.internal_stop=t.stop,t.stop=function(n){t.internal_stop(n||0)}):t.stop=function(n){this.noteOff(n||0)},n(t.playbackRate),t},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var t=this.internal_createDynamicsCompressor();return n(t.threshold),n(t.knee),n(t.ratio),n(t.reduction),n(t.attack),n(t.release),t},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var t=this.internal_createBiquadFilter();return n(t.frequency),n(t.detune),n(t.Q),n(t.gain),t},typeof AudioContext.prototype.createOscillator!="function"&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var t=this.internal_createOscillator();return t.start?(t.internal_start=t.start,t.start=function(n){t.internal_start(n||0)}):t.start=function(n){this.noteOn(n||0)},t.stop?(t.internal_stop=t.stop,t.stop=function(n){t.internal_stop(n||0)}):t.stop=function(n){this.noteOff(n||0)},t.setPeriodicWave||(t.setPeriodicWave=t.setWaveTable),n(t.frequency),n(t.detune),t}));window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")&&(window.OfflineAudioContext=window.webkitOfflineAudioContext)})(window);i=new window.AudioContext;n.prototype.getAudioContext=function(){return i};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;t=document.createElement("audio");n.prototype.isSupported=function(){return!!t.canPlayType};var e=function(){return!!t.canPlayType&&t.canPlayType('audio/ogg; codecs="vorbis"')},o=function(){return!!t.canPlayType&&t.canPlayType("audio/mpeg;")},s=function(){return!!t.canPlayType&&t.canPlayType('audio/wav; codecs="1"')},h=function(){return!!t.canPlayType&&(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;"))},c=function(){return!!t.canPlayType&&t.canPlayType("audio/x-aiff;")};n.prototype.isFileSupported=function(n){switch(n.toLowerCase()){case"mp3":return o();case"wav":return s();case"ogg":return e();case"aac":case"m4a":case"mp4":return h();case"aif":case"aiff":return c();default:return!1}};f=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;f&&(r=!1,u=function(){if(!r){var t=i.createBuffer(1,1,22050),n=i.createBufferSource();n.buffer=t;n.connect(i.destination);n.start(0);console.log("start ios!");i.state==="running"&&(r=!0)}},document.addEventListener("touchend",u,!1),document.addEventListener("touchstart",u,!1))}();t=function(){var i=function(){var t=n.prototype.getAudioContext();this.input=t.createGain();this.output=t.createGain();this.limiter=t.createDynamicsCompressor();this.limiter.threshold.value=0;this.limiter.ratio.value=20;this.audiocontext=t;this.output.disconnect();this.input.connect(this.limiter);this.limiter.connect(this.output);this.meter=t.createGain();this.fftMeter=t.createGain();this.output.connect(this.meter);this.output.connect(this.fftMeter);this.output.connect(this.audiocontext.destination);this.soundArray=[];this.parts=[];this.extensions=[]},t=new i;return n.prototype.getMasterVolume=function(){return t.output.gain.value},n.prototype.masterVolume=function(n,i,r){if(typeof n=="number"){var i=i||0,r=r||0,u=t.audiocontext.currentTime,f=t.output.gain.value;t.output.gain.cancelScheduledValues(u+r);t.output.gain.linearRampToValueAtTime(f,u+r);t.output.gain.linearRampToValueAtTime(n,u+r+i)}else if(n)n.connect(t.output.gain);else return t.output.gain},n.prototype.soundOut=n.soundOut=t,n.soundOut._silentNode=t.audiocontext.createGain(),n.soundOut._silentNode.gain.value=0,n.soundOut._silentNode.connect(t.audiocontext.destination),t}();y=function(){var i=t;return n.prototype.sampleRate=function(){return i.audiocontext.sampleRate},n.prototype.freqToMidi=function(n){var t=Math.log(n/440)/Math.log(2);return Math.round(12*t)+69},n.prototype.midiToFreq=function(n){return 440*Math.pow(2,(n-69)/12)},n.prototype.soundFormats=function(){i.extensions=[];for(var n=0;n<arguments.length;n++)if(arguments[n]=arguments[n].toLowerCase(),["mp3","wav","ogg","m4a","aac"].indexOf(arguments[n])>-1)i.extensions.push(arguments[n]);else throw arguments[n]+" is not a valid sound format!";},n.prototype.disposeSound=function(){for(var n=0;n<i.soundArray.length;n++)i.soundArray[n].dispose()},n.prototype.registerMethod("remove",n.prototype.disposeSound),n.prototype._checkFileFormats=function(t){var u,h,e,s,c,r,f,o;if(typeof t=="string"){if(u=t,h=u.split(".").pop(),["mp3","wav","ogg","m4a","aac"].indexOf(h)>-1){if(n.prototype.isFileSupported(h))u=u;else for(e=u.split("."),s=e[e.length-1],r=0;r<i.extensions.length;r++)if(f=i.extensions[r],o=n.prototype.isFileSupported(f),o){for(s="",e.length===2&&(s+=e[0]),r=1;r<=e.length-2;r++)c=e[r],s+="."+c;u=s+=".";u=u+=f;break}}else for(r=0;r<i.extensions.length;r++)if(f=i.extensions[r],o=n.prototype.isFileSupported(f),o){u=u+"."+f;break}}else if(typeof t=="object")for(r=0;r<t.length;r++)if(f=t[r].split(".").pop(),o=n.prototype.isFileSupported(f),o){u=t[r];break}return u},n.prototype._mathChain=function(n,t,i,r,u){for(var f in n.mathOps)n.mathOps[f]instanceof u&&(n.mathOps[f].dispose(),i=f,i<n.mathOps.length-1&&(r=n.mathOps[f+1]));return n.mathOps[i-1].disconnect(),n.mathOps[i-1].connect(t),t.connect(r),n.mathOps[i]=t,n},{midiToFreq:n.prototype.midiToFreq}}(t);s=function(){return function(n,t,i){var r=new Error,f,u;return r.name=n,r.originalStack=r.stack+t,f=r.stack+t,r.failedPath=i,u=f.split("\n"),u=u.filter(function(n){return!n.match(/(p5.|native code|globalInit)/g)}),r.stack=u.join("\n"),r}}();ut=function(){var r=t,i=r.audiocontext;typeof i.createStereoPanner!="undefined"?(n.Panner=function(n,t){this.stereoPanner=this.input=i.createStereoPanner();n.connect(this.stereoPanner);this.stereoPanner.connect(t)},n.Panner.prototype.pan=function(n,t){var r=t||0,u=i.currentTime+r;this.stereoPanner.pan.linearRampToValueAtTime(n,u)},n.Panner.prototype.inputChannels=function(){},n.Panner.prototype.connect=function(n){this.stereoPanner.connect(n)},n.Panner.prototype.disconnect=function(){this.stereoPanner.disconnect()}):(n.Panner=function(n,t,r){this.input=i.createGain();n.connect(this.input);this.left=i.createGain();this.right=i.createGain();this.left.channelInterpretation="discrete";this.right.channelInterpretation="discrete";r>1?(this.splitter=i.createChannelSplitter(2),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0)):(this.input.connect(this.left),this.input.connect(this.right));this.output=i.createChannelMerger(2);this.left.connect(this.output,0,1);this.right.connect(this.output,0,0);this.output.connect(t)},n.Panner.prototype.pan=function(n,t){var f=t||0,r=i.currentTime+f,u=(n+1)/2,e=Math.cos(u*Math.PI/2),o=Math.sin(u*Math.PI/2);this.left.gain.linearRampToValueAtTime(o,r);this.right.gain.linearRampToValueAtTime(e,r)},n.Panner.prototype.inputChannels=function(n){n===1?(this.input.disconnect(),this.input.connect(this.left),this.input.connect(this.right)):n===2&&(typeof(this.splitter==="undefined")&&(this.splitter=i.createChannelSplitter(2)),this.input.disconnect(),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0))},n.Panner.prototype.connect=function(n){this.output.connect(n)},n.Panner.prototype.disconnect=function(){this.output.disconnect()})}(t);ft=function(){function l(n,t){for(var u,f,r={},e=n.length,i=0;i<e;i++)n[i]>t&&(u=n[i],f=new o(u,i),r[i]=f,i+=6e3),i++;return r}function a(n){for(var i,r,o,s,f=[],e=Object.keys(n).sort(),t=0;t<e.length;t++)for(i=0;i<10;i++)if(r=n[e[t]],o=n[e[t+i]],r&&o){var h=r.sampleIndex,c=o.sampleIndex,u=c-h;u>0&&r.intervals.push(u);s=f.some(function(n){if(n.interval===u)return n.count++,n});s||f.push({interval:u,count:1})}return f}function v(n,t){var i=[];return n.forEach(function(n){var r,u;try{if(r=Math.abs(60/(n.interval/t)),r=h(r),u=i.some(function(t){if(t.tempo===r)return t.count+=n.count}),!u){if(isNaN(r))return;i.push({tempo:Math.round(r),count:n.count})}}catch(f){throw f;}}),i}function p(n,t,i,r){for(var l,u,f,e,s=[],c=Object.keys(n).sort(),o=0;o<c.length;o++)for(l=c[o],u=n[l],f=0;f<u.intervals.length;f++)e=Math.round(Math.abs(60/(u.intervals[f]/i))),e=h(e),Math.abs(e-t)<r&&s.push(u.sampleIndex/i);return s.filter(function(n,t,i){var r=i[t+1]-n;if(r>.01)return!0})}function h(n){if(isFinite(n)&&n!==0){while(n<90)n*=2;while(n>180&&n>90)n/=2;return n}}var u=s,i=t,r=i.audiocontext,f=y.midiToFreq,e,o,c;n.SoundFile=function(t,r,u,f){if(typeof t!="undefined"){if(typeof t=="string"||typeof t[0]=="string"){var e=n.prototype._checkFileFormats(t);this.url=e}else if(typeof t=="object"&&!(window.File&&window.FileReader&&window.FileList&&window.Blob))throw"Unable to load file because the File API is not supported";t.file&&(t=t.file);this.file=t}this._onended=function(){};this._looping=!1;this._playing=!1;this._paused=!1;this._pauseTime=0;this._cues=[];this._lastPos=0;this._counterNode=null;this._scopeNode=null;this.bufferSourceNodes=[];this.bufferSourceNode=null;this.buffer=null;this.playbackRate=1;this.input=i.audiocontext.createGain();this.output=i.audiocontext.createGain();this.reversed=!1;this.startTime=0;this.endTime=null;this.pauseTime=0;this.mode="sustain";this.startMillis=null;this.panPosition=0;this.panner=new n.Panner(this.output,i.input,2);(this.url||this.file)&&this.load(r,u);i.soundArray.push(this);this._whileLoading=typeof f=="function"?f:function(){}};n.prototype.registerPreloadMethod("loadSound",n.prototype);n.prototype.loadSound=function(t,i,r,u){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&window.alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var f=this;return new n.SoundFile(t,function(){typeof i=="function"&&i.apply(f,arguments);f._decrementPreload()},r,u)};n.SoundFile.prototype.load=function(n,t){var i=this,o=(new Error).stack,f,e;this.url!==undefined&&this.url!==""?(f=new XMLHttpRequest,f.addEventListener("progress",function(n){i._updateProgress(n)},!1),f.open("GET",this.url,!0),f.responseType="arraybuffer",f.onload=function(){if(f.status===200)r.decodeAudioData(f.response,function(t){i.buffer=t;i.panner.inputChannels(t.numberOfChannels);n&&n(i)},function(){var n=new u("decodeAudioData",o,i.url),r="AudioContext error at decodeAudioData for "+i.url;t?(n.msg=r,t(n)):console.error(r+"\n The error stack trace includes: \n"+n.stack)});else{var e=new u("loadSound",o,i.url),s="Unable to load "+i.url+". The request status was: "+f.status+" ("+f.statusText+")";t?(e.message=s,t(e)):console.error(s+"\n The error stack trace includes: \n"+e.stack)}},f.onerror=function(){var n=new u("loadSound",o,i.url),r="There was no response from the server at "+i.url+". Check the url and internet connectivity.";t?(n.message=r,t(n)):console.error(r+"\n The error stack trace includes: \n"+n.stack)},f.send()):this.file!==undefined&&(e=new FileReader,e.onload=function(){r.decodeAudioData(e.result,function(t){i.buffer=t;i.panner.inputChannels(t.numberOfChannels);n&&n(i)})},e.onerror=function(n){onerror&&onerror(n)},e.readAsArrayBuffer(this.file))};n.SoundFile.prototype._updateProgress=function(n){if(n.lengthComputable){var t=n.loaded/n.total*.99;this._whileLoading(t,n)}else this._whileLoading("size unknown")};n.SoundFile.prototype.isLoaded=function(){return this.buffer?!0:!1};n.SoundFile.prototype.play=function(n,t,r,u,f){var s=this,l=i.audiocontext.currentTime,o,h,e=n||0,c;if(e<0&&(e=0),e=e+l,typeof t!="undefined"&&this.rate(t),typeof r!="undefined"&&this.setVolume(r),this.buffer){if(this._pauseTime=0,this.mode==="restart"&&this.buffer&&this.bufferSourceNode&&(this.bufferSourceNode.stop(e),this._counterNode.stop(e)),this.mode==="untildone"&&this.isPlaying())return;if(this.bufferSourceNode=this._initSourceNode(),delete this._counterNode,this._counterNode=this._initCounterNode(),u)if(u>=0&&u<this.buffer.duration)o=u;else throw"start time out of range";else o=0;f&&(f=f<=this.buffer.duration-o?f:this.buffer.duration);this._paused?(this.bufferSourceNode.start(e,this.pauseTime,f),this._counterNode.start(e,this.pauseTime,f)):(this.bufferSourceNode.start(e,o,f),this._counterNode.start(e,o,f));this._playing=!0;this._paused=!1;this.bufferSourceNodes.push(this.bufferSourceNode);this.bufferSourceNode._arrayIndex=this.bufferSourceNodes.length-1;c=function(){this._playing=!1;this.removeEventListener("ended",c,!1);s._onended(s);s.bufferSourceNodes.forEach(function(n,t){n._playing===!1&&s.bufferSourceNodes.splice(t)});s.bufferSourceNodes.length===0&&(s._playing=!1)};this.bufferSourceNode.onended=c}else throw"not ready to play file, buffer has yet to load. Try preload()";this.bufferSourceNode.loop=this._looping;this._counterNode.loop=this._looping;this._looping===!0&&(h=f?f:o-1e-15,this.bufferSourceNode.loopStart=o,this.bufferSourceNode.loopEnd=h,this._counterNode.loopStart=o,this._counterNode.loopEnd=h)};n.SoundFile.prototype.playMode=function(n){var t=n.toLowerCase(),r,u;if(t==="restart"&&this.buffer&&this.bufferSourceNode)for(r=0;r<this.bufferSourceNodes.length-1;r++)u=i.audiocontext.currentTime,this.bufferSourceNodes[r].stop(u);if(t==="restart"||t==="sustain"||t==="untildone")this.mode=t;else throw'Invalid play mode. Must be either "restart" or "sustain"';};n.SoundFile.prototype.pause=function(n){var r=i.audiocontext.currentTime,u=n||0,t=u+r;this.isPlaying()&&this.buffer&&this.bufferSourceNode?(this.pauseTime=this.currentTime(),this.bufferSourceNode.stop(t),this._counterNode.stop(t),this._paused=!0,this._playing=!1,this._pauseTime=this.currentTime()):this._pauseTime=0};n.SoundFile.prototype.loop=function(n,t,i,r,u){this._looping=!0;this.play(n,t,i,r,u)};n.SoundFile.prototype.setLoop=function(n){if(n===!0)this._looping=!0;else if(n===!1)this._looping=!1;else throw"Error: setLoop accepts either true or false";this.bufferSourceNode&&(this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping)};n.SoundFile.prototype.isLooping=function(){return this.bufferSourceNode?this._looping===!0&&this.isPlaying()===!0?!0:!1:!1};n.SoundFile.prototype.isPlaying=function(){return this._playing};n.SoundFile.prototype.isPaused=function(){return this._paused};n.SoundFile.prototype.stop=function(n){var u=n||0,t,r;this.mode==="sustain"||this.mode==="untildone"?(this.stopAll(u),this._playing=!1,this.pauseTime=0,this._paused=!1):this.buffer&&this.bufferSourceNode&&(t=i.audiocontext.currentTime,r=u||0,this.pauseTime=0,this.bufferSourceNode.stop(t+r),this._counterNode.stop(t+r),this._playing=!1,this._paused=!1)};n.SoundFile.prototype.stopAll=function(n){var r=i.audiocontext.currentTime,u=n||0,t;if(this.buffer&&this.bufferSourceNode){for(t=0;t<this.bufferSourceNodes.length;t++)if(typeof this.bufferSourceNodes[t]!==undefined)try{this.bufferSourceNodes[t].onended=function(){};this.bufferSourceNodes[t].stop(r+u)}catch(f){}this._counterNode.stop(r+u);this._onended(this)}};n.SoundFile.prototype.setVolume=function(n,t,r){if(typeof n=="number"){var e=t||0,u=r||0,f=i.audiocontext.currentTime,o=this.output.gain.value;this.output.gain.cancelScheduledValues(f+u);this.output.gain.linearRampToValueAtTime(o,f+u);this.output.gain.linearRampToValueAtTime(n,f+u+e)}else if(n)n.connect(this.output.gain);else return this.output.gain};n.SoundFile.prototype.amp=n.SoundFile.prototype.setVolume;n.SoundFile.prototype.fade=n.SoundFile.prototype.setVolume;n.SoundFile.prototype.getVolume=function(){return this.output.gain.value};n.SoundFile.prototype.pan=function(n,t){this.panPosition=n;this.panner.pan(n,t)};n.SoundFile.prototype.getPan=function(){return this.panPosition};n.SoundFile.prototype.rate=function(n){var r=!1,t;return typeof n=="undefined"?this.playbackRate:(this.playbackRate=n,n===0?n=1e-13:n<0&&!this.reversed?(n=Math.abs(n),r=!0):n>0&&this.reversed&&(r=!0),this.bufferSourceNode&&(t=i.audiocontext.currentTime,this.bufferSourceNode.playbackRate.cancelScheduledValues(t),this.bufferSourceNode.playbackRate.linearRampToValueAtTime(Math.abs(n),t),this._counterNode.playbackRate.cancelScheduledValues(t),this._counterNode.playbackRate.linearRampToValueAtTime(Math.abs(n),t)),r&&this.reverseBuffer(),this.playbackRate)};n.SoundFile.prototype.setPitch=function(n){var t=f(n)/f(60);this.rate(t)};n.SoundFile.prototype.getPlaybackRate=function(){return this.playbackRate};n.SoundFile.prototype.duration=function(){return this.buffer?this.buffer.duration:0};n.SoundFile.prototype.currentTime=function(){return this.reversed?Math.abs(this._lastPos-this.buffer.length)/r.sampleRate:this._lastPos/r.sampleRate};n.SoundFile.prototype.jump=function(n,t){if(n<0||n>this.buffer.duration)throw"jump time out of range";if(t>this.buffer.duration-n)throw"end time out of range";var i=n||0,r=t||undefined;this.isPlaying()&&this.stop(0);this.play(0,this.playbackRate,this.output.gain.value,i,r)};n.SoundFile.prototype.channels=function(){return this.buffer.numberOfChannels};n.SoundFile.prototype.sampleRate=function(){return this.buffer.sampleRate};n.SoundFile.prototype.frames=function(){return this.buffer.length};n.SoundFile.prototype.getPeaks=function(n){var r,h,t,f,u;if(this.buffer){if(n||(n=window.width*5),this.buffer){var e=this.buffer,o=e.length/n,l=~~(o/10)||1,a=e.numberOfChannels,s=new Float32Array(Math.round(n));for(r=0;r<a;r++)for(h=e.getChannelData(r),t=0;t<n;t++){var c=~~(t*o),v=~~(c+o),i=0;for(f=c;f<v;f+=l)u=h[f],u>i?i=u:-u>i&&(i=u);(r===0||Math.abs(i)>s[t])&&(s[t]=i)}return s}}else throw"Cannot load peaks yet, buffer is not loaded";};n.SoundFile.prototype.reverseBuffer=function(){var t,i,n;if(this.buffer){t=this._lastPos/r.sampleRate;i=this.getVolume();this.setVolume(0,.001);const u=this.buffer.numberOfChannels;for(n=0;n<u;n++)this.buffer.getChannelData(n).reverse();this.reversed=!this.reversed;t&&this.jump(this.duration()-t);this.setVolume(i,.001)}else throw"SoundFile is not done loading";};n.SoundFile.prototype.onended=function(n){return this._onended=n,this};n.SoundFile.prototype.add=function(){};n.SoundFile.prototype.dispose=function(){var t=i.audiocontext.currentTime,r=i.soundArray.indexOf(this),n;if(i.soundArray.splice(r,1),this.stop(t),this.buffer&&this.bufferSourceNode){for(n=0;n<this.bufferSourceNodes.length-1;n++)if(this.bufferSourceNodes[n]!==null){this.bufferSourceNodes[n].disconnect();try{this.bufferSourceNodes[n].stop(t)}catch(u){console.warning("no buffer source node to dispose")}this.bufferSourceNodes[n]=null}if(this.isPlaying()){try{this._counterNode.stop(t)}catch(u){console.log(u)}this._counterNode=null}}this.output&&(this.output.disconnect(),this.output=null);this.panner&&(this.panner.disconnect(),this.panner=null)};n.SoundFile.prototype.connect=function(n){n?n.hasOwnProperty("input")?this.panner.connect(n.input):this.panner.connect(n):this.panner.connect(i.input)};n.SoundFile.prototype.disconnect=function(){this.panner.disconnect()};n.SoundFile.prototype.getLevel=function(){console.warn("p5.SoundFile.getLevel has been removed from the library. Use p5.Amplitude instead")};n.SoundFile.prototype.setPath=function(t,i){var r=n.prototype._checkFileFormats(t);this.url=r;this.load(i)};n.SoundFile.prototype.setBuffer=function(n){var i=n.length,e=n[0].length,u=r.createBuffer(i,e,r.sampleRate),t,f;for(n[0]instanceof Float32Array||(n[0]=new Float32Array(n[0])),t=0;t<i;t++)f=u.getChannelData(t),f.set(n[t]);this.buffer=u;this.panner.inputChannels(i)};e=function(n){const u=n.length,i=r.createBuffer(1,n.length,r.sampleRate),f=i.getChannelData(0);for(var t=0;t<u;t++)f[t]=t;return i};n.SoundFile.prototype._initCounterNode=function(){var t=this,u=r.currentTime,i=r.createBufferSource();return t._scopeNode&&(t._scopeNode.disconnect(),delete t._scopeNode.onaudioprocess,delete t._scopeNode),t._scopeNode=r.createScriptProcessor(256,1,1),i.buffer=e(t.buffer),i.playbackRate.setValueAtTime(t.playbackRate,u),i.connect(t._scopeNode),t._scopeNode.connect(n.soundOut._silentNode),t._scopeNode.onaudioprocess=function(n){var i=n.inputBuffer.getChannelData(0);t._lastPos=i[i.length-1]||0;t._onTimeUpdate(t._lastPos)},i};n.SoundFile.prototype._initSourceNode=function(){var n=r.createBufferSource();return n.buffer=this.buffer,n.playbackRate.value=this.playbackRate,n.connect(this.output),n};n.SoundFile.prototype.processPeaks=function(n,t,i,r){var h=this.buffer.length,c=this.buffer.sampleRate,y=this.buffer,f=[],w=t||.9,o=w,b=i||.22,k=r||200,u=new window.OfflineAudioContext(1,h,c),s=u.createBufferSource(),e;s.buffer=y;e=u.createBiquadFilter();e.type="lowpass";s.connect(e);e.connect(u.destination);s.start(0);u.startRendering();u.oncomplete=function(t){var i=t.renderedBuffer,s=i.getChannelData(0),u,e;do f=l(s,o),o-=.005;while(Object.keys(f).length<k&&o>=b);var h=a(f),c=v(h,i.sampleRate),r=c.sort(function(n,t){return t.count-n.count}).splice(0,5);this.tempo=r[0].tempo;u=5;e=p(f,r[0].tempo,i.sampleRate,u);n(e)}};o=function(n,t){this.sampleIndex=t;this.amplitude=n;this.tempos=[];this.intervals=[]};c=function(n,t,i,r){this.callback=n;this.time=t;this.id=i;this.val=r};n.SoundFile.prototype.addCue=function(n,t,i){var r=this._cueIDCounter++,u=new c(t,n,r,i);return this._cues.push(u),r};n.SoundFile.prototype.removeCue=function(n){for(var i,r=this._cues.length,t=0;t<r;t++)i=this._cues[t],i.id===n&&this.cues.splice(t,1);this._cues.length===0};n.SoundFile.prototype.clearCues=function(){this._cues=[]};n.SoundFile.prototype._onTimeUpdate=function(n){for(var r=n/this.buffer.sampleRate,f=this._cues.length,t=0;t<f;t++){var i=this._cues[t],u=i.time,e=i.val;this._prevTime<u&&u<=r&&i.callback(e)}this._prevTime=r}}(o,s,t,y);et=function(){var i=t;n.Amplitude=function(n){this.bufferSize=2048;this.audiocontext=i.audiocontext;this.processor=this.audiocontext.createScriptProcessor(this.bufferSize,2,1);this.input=this.processor;this.output=this.audiocontext.createGain();this.smoothing=n||0;this.volume=0;this.average=0;this.stereoVol=[0,0];this.stereoAvg=[0,0];this.stereoVolNorm=[0,0];this.volMax=.001;this.normalize=!1;this.processor.onaudioprocess=this._audioProcess.bind(this);this.processor.connect(this.output);this.output.gain.value=0;this.output.connect(this.audiocontext.destination);i.meter.connect(this.processor);i.soundArray.push(this)};n.Amplitude.prototype.setInput=function(t,r){i.meter.disconnect();r&&(this.smoothing=r);t==null?(console.log("Amplitude input source is not ready! Connecting to master output instead"),i.meter.connect(this.processor)):t instanceof n.Signal?t.output.connect(this.processor):t?(t.connect(this.processor),this.processor.disconnect(),this.processor.connect(this.output)):i.meter.connect(this.processor)};n.Amplitude.prototype.connect=function(n){n?n.hasOwnProperty("input")?this.output.connect(n.input):this.output.connect(n):this.output.connect(this.panner.connect(i.input))};n.Amplitude.prototype.disconnect=function(){this.output.disconnect()};n.Amplitude.prototype._audioProcess=function(n){for(var u,h,c,r,l,t=0;t<n.inputBuffer.numberOfChannels;t++){var s=n.inputBuffer.getChannelData(t),f=s.length,e=0,o=0,i;for(u=0;u<f;u++)i=s[u],this.normalize?(e+=Math.max(Math.min(i/this.volMax,1),-1),o+=Math.max(Math.min(i/this.volMax,1),-1)*Math.max(Math.min(i/this.volMax,1),-1)):(e+=i,o+=i*i);h=e/f;c=Math.sqrt(o/f);this.stereoVol[t]=Math.max(c,this.stereoVol[t]*this.smoothing);this.stereoAvg[t]=Math.max(h,this.stereoVol[t]*this.smoothing);this.volMax=Math.max(this.stereoVol[t],this.volMax)}r=this;l=this.stereoVol.reduce(function(n,t,i){return r.stereoVolNorm[i-1]=Math.max(Math.min(r.stereoVol[i-1]/r.volMax,1),0),r.stereoVolNorm[i]=Math.max(Math.min(r.stereoVol[i]/r.volMax,1),0),n+t});this.volume=l/this.stereoVol.length;this.volNorm=Math.max(Math.min(this.volume/this.volMax,1),0)};n.Amplitude.prototype.getLevel=function(n){return typeof n!="undefined"?this.normalize?this.stereoVolNorm[n]:this.stereoVol[n]:this.normalize?this.volNorm:this.volume};n.Amplitude.prototype.toggleNormalize=function(n){this.normalize=typeof n=="boolean"?n:!this.normalize};n.Amplitude.prototype.smooth=function(n){n>=0&&n<1?this.smoothing=n:console.log("Error: smoothing must be between 0 and 1")};n.Amplitude.prototype.dispose=function(){var n=i.soundArray.indexOf(this);i.soundArray.splice(n,1);this.input.disconnect();this.output.disconnect();this.input=this.processor=undefined;this.output=undefined}}(t);ot=function(){var i=t;n.FFT=function(n,t){this.input=this.analyser=i.audiocontext.createAnalyser();Object.defineProperties(this,{bins:{get:function(){return this.analyser.fftSize/2},set:function(n){this.analyser.fftSize=n*2},configurable:!0,enumerable:!0},smoothing:{get:function(){return this.analyser.smoothingTimeConstant},set:function(n){this.analyser.smoothingTimeConstant=n},configurable:!0,enumerable:!0}});this.smooth(n);this.bins=t||1024;i.fftMeter.connect(this.analyser);this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount);this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount);this.bass=[20,140];this.lowMid=[140,400];this.mid=[400,2600];this.highMid=[2600,5200];this.treble=[5200,14e3];i.soundArray.push(this)};n.FFT.prototype.setInput=function(n){n?(n.output?n.output.connect(this.analyser):n.connect&&n.connect(this.analyser),i.fftMeter.disconnect()):i.fftMeter.connect(this.analyser)};n.FFT.prototype.waveform=function(){for(var r,i,s,u,o,t=0;t<arguments.length;t++)typeof arguments[t]=="number"&&(u=arguments[t],this.analyser.fftSize=u*2),typeof arguments[t]=="string"&&(o=arguments[t]);if(o&&!n.prototype._isSafari())return f(this,this.timeDomain),this.analyser.getFloatTimeDomainData(this.timeDomain),this.timeDomain;for(e(this,this.timeDomain),this.analyser.getByteTimeDomainData(this.timeDomain),r=[],i=0;i<this.timeDomain.length;i++)s=n.prototype.map(this.timeDomain[i],0,255,-1,1),r.push(s);return r};n.FFT.prototype.analyze=function(){for(var t,i,n=0;n<arguments.length;n++)typeof arguments[n]=="number"&&(this.bins=arguments[n],this.analyser.fftSize=this.bins*2),typeof arguments[n]=="string"&&(i=arguments[n]);return i&&i.toLowerCase()==="db"?(r(this),this.analyser.getFloatFrequencyData(this.freqDomain),this.freqDomain):(u(this,this.freqDomain),this.analyser.getByteFrequencyData(this.freqDomain),t=Array.apply([],this.freqDomain),t.length===this.analyser.fftSize,t.constructor===Array,t)};n.FFT.prototype.getEnergy=function(n,t){var u=i.audiocontext.sampleRate/2,f,e,r;if(n==="bass"?(n=this.bass[0],t=this.bass[1]):n==="lowMid"?(n=this.lowMid[0],t=this.lowMid[1]):n==="mid"?(n=this.mid[0],t=this.mid[1]):n==="highMid"?(n=this.highMid[0],t=this.highMid[1]):n==="treble"&&(n=this.treble[0],t=this.treble[1]),typeof n!="number")throw"invalid input for getEnergy()";else if(t){if(n&&t){n>t&&(e=t,t=n,n=e);var h=Math.round(n/u*this.freqDomain.length),c=Math.round(t/u*this.freqDomain.length),o=0,s=0;for(r=h;r<=c;r++)o+=this.freqDomain[r],s+=1;return o/s}throw"invalid input for getEnergy()";}else return f=Math.round(n/u*this.freqDomain.length),this.freqDomain[f]};n.FFT.prototype.getFreq=function(n,t){console.log("getFreq() is deprecated. Please use getEnergy() instead.");return this.getEnergy(n,t)};n.FFT.prototype.getCentroid=function(){for(var r,f=i.audiocontext.sampleRate/2,u=0,t=0,n=0;n<this.freqDomain.length;n++)u+=n*this.freqDomain[n],t+=this.freqDomain[n];return r=0,t!==0&&(r=u/t),r*(f/this.freqDomain.length)};n.FFT.prototype.smooth=function(n){return typeof n!="undefined"&&(this.smoothing=n),this.smoothing};n.FFT.prototype.dispose=function(){var n=i.soundArray.indexOf(this);i.soundArray.splice(n,1);this.analyser.disconnect();this.analyser=undefined};n.FFT.prototype.linAverages=function(n){for(var n=n||16,u=this.freqDomain,f=u.length,e=Math.floor(f/n),i=new Array(n),r=0,t=0;t<f;t++)i[r]=i[r]!==undefined?(i[r]+u[t])/2:u[t],t%e==e-1&&r++;return i};n.FFT.prototype.logAverages=function(n){for(var e,o=i.audiocontext.sampleRate/2,f=this.freqDomain,s=f.length,u=new Array(n.length),t=0,r=0;r<s;r++)e=Math.round(r*o/this.freqDomain.length),e>n[t].hi&&t++,u[t]=u[t]!==undefined?(u[t]+f[r])/2:f[r];return u};n.FFT.prototype.getOctaveBands=function(n,t){var n=n||3,t=t||15.625,f=[],u={lo:t/Math.pow(2,1/(2*n)),ctr:t,hi:t*Math.pow(2,1/(2*n))},e,r;for(f.push(u),e=i.audiocontext.sampleRate/2;u.hi<e;)r={},r.lo=u.hi,r.ctr=u.ctr*Math.pow(2,1/n),r.hi=r.ctr*Math.pow(2,1/(2*n)),f.push(r),u=r;return f};var r=function(n){n.freqDomain instanceof Float32Array==!1&&(n.freqDomain=new Float32Array(n.analyser.frequencyBinCount))},u=function(n){n.freqDomain instanceof Uint8Array==!1&&(n.freqDomain=new Uint8Array(n.analyser.frequencyBinCount))},f=function(n){n.timeDomain instanceof Float32Array==!1&&(n.timeDomain=new Float32Array(n.analyser.frequencyBinCount))},e=function(n){n.timeDomain instanceof Uint8Array==!1&&(n.timeDomain=new Uint8Array(n.analyser.frequencyBinCount))}}(t);i=function(){"use strict";var n=function(n,t){this.isUndef(n)||n===1?this.input=this.context.createGain():n>1&&(this.input=new Array(n));this.isUndef(t)||t===1?this.output=this.context.createGain():t>1&&(this.output=new Array(n))},t;return n.prototype.set=function(t,i,r){var h,f,e,o,s,c,u;this.isObject(t)?r=i:this.isString(t)&&(h={},h[t]=i,t=h);n:for(f in t){if(i=t[f],e=this,f.indexOf(".")!==-1){for(o=f.split("."),s=0;s<o.length-1;s++)if(e=e[o[s]],e instanceof n){o.splice(0,s+1);c=o.join(".");e.set(c,i);continue n}f=o[o.length-1]}(u=e[f],this.isUndef(u))||(n.Signal&&u instanceof n.Signal||n.Param&&u instanceof n.Param?u.value!==i&&(this.isUndef(r)?u.value=i:u.rampTo(i,r)):u instanceof AudioParam?u.value!==i&&(u.value=i):u instanceof n?u.set(i):u!==i&&(e[f]=i))}return this},n.prototype.get=function(t){var h,o,f,s,e,i;for(this.isUndef(t)?t=this._collectDefaults(this.constructor):this.isString(t)&&(t=[t]),h={},o=0;o<t.length;o++){var r=t[o],c=this,u=h;if(r.indexOf(".")!==-1){for(f=r.split("."),s=0;s<f.length-1;s++)e=f[s],u[e]=u[e]||{},u=u[e],c=c[e];r=f[f.length-1]}i=c[r];this.isObject(t[r])?u[r]=i.get():n.Signal&&i instanceof n.Signal?u[r]=i.value:n.Param&&i instanceof n.Param?u[r]=i.value:i instanceof AudioParam?u[r]=i.value:i instanceof n?u[r]=i.get():this.isFunction(i)||this.isUndef(i)||(u[r]=i)}return h},n.prototype._collectDefaults=function(n){var i=[],r,t;if(this.isUndef(n.defaults)||(i=Object.keys(n.defaults)),!this.isUndef(n._super))for(r=this._collectDefaults(n._super),t=0;t<r.length;t++)i.indexOf(r[t])===-1&&i.push(r[t]);return i},n.prototype.toString=function(){var t,i,r;for(t in n)if(i=t[0].match(/^[A-Z]$/),r=n[t]===this.constructor,this.isFunction(n[t])&&i&&r)return t;return"Tone"},Object.defineProperty(n.prototype,"numberOfInputs",{get:function(){return this.input?this.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(n.prototype,"numberOfOutputs",{get:function(){return this.output?this.isArray(this.output)?this.output.length:1:0}}),n.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this},n.prototype.connect=function(n,t,i){return Array.isArray(this.output)?(t=this.defaultArg(t,0),this.output[t].connect(n,0,i)):this.output.connect(n,t,i),this},n.prototype.disconnect=function(n,t,i){this.isArray(this.output)?this.isNumber(n)?this.output[n].disconnect():(t=this.defaultArg(t,0),this.output[t].disconnect(n,0,i)):this.output.disconnect.apply(this.output,arguments)},n.prototype.connectSeries=function(){var t,n,i;if(arguments.length>1)for(t=arguments[0],n=1;n<arguments.length;n++)i=arguments[n],t.connect(i),t=i;return this},n.prototype.chain=function(){var t,n,i;if(arguments.length>0)for(t=this,n=0;n<arguments.length;n++)i=arguments[n],t.connect(i),t=i;return this},n.prototype.fan=function(){if(arguments.length>0)for(var n=0;n<arguments.length;n++)this.connect(arguments[n]);return this},AudioNode.prototype.chain=n.prototype.chain,AudioNode.prototype.fan=n.prototype.fan,n.prototype.defaultArg=function(n,t){var i,r,u;if(this.isObject(n)&&this.isObject(t)){i={};for(r in n)i[r]=this.defaultArg(t[r],n[r]);for(u in t)i[u]=this.defaultArg(n[u],t[u]);return i}return this.isUndef(n)?t:n},n.prototype.optionsObject=function(n,t,i){var u={},r;if(n.length===1&&this.isObject(n[0]))u=n[0];else for(r=0;r<t.length;r++)u[t[r]]=n[r];return this.isUndef(i)?u:this.defaultArg(u,i)},n.prototype.isUndef=function(n){return typeof n=="undefined"},n.prototype.isFunction=function(n){return typeof n=="function"},n.prototype.isNumber=function(n){return typeof n=="number"},n.prototype.isObject=function(n){return Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object},n.prototype.isBoolean=function(n){return typeof n=="boolean"},n.prototype.isArray=function(n){return Array.isArray(n)},n.prototype.isString=function(n){return typeof n=="string"},n.noOp=function(){},n.prototype._readOnly=function(n){if(Array.isArray(n))for(var t=0;t<n.length;t++)this._readOnly(n[t]);else Object.defineProperty(this,n,{writable:!1,enumerable:!0})},n.prototype._writable=function(n){if(Array.isArray(n))for(var t=0;t<n.length;t++)this._writable(n[t]);else Object.defineProperty(this,n,{writable:!0})},n.State={Started:"started",Stopped:"stopped",Paused:"paused"},n.prototype.equalPowerScale=function(n){var t=.5*Math.PI;return Math.sin(n*t)},n.prototype.dbToGain=function(n){return Math.pow(2,n/6)},n.prototype.gainToDb=function(n){return 20*(Math.log(n)/Math.LN10)},n.prototype.intervalToFrequencyRatio=function(n){return Math.pow(2,n/12)},n.prototype.now=function(){return n.context.now()},n.now=function(){return n.context.now()},n.extend=function(t,i){function r(){}n.prototype.isUndef(i)&&(i=n);r.prototype=i.prototype;t.prototype=new r;t.prototype.constructor=t;t._super=i},Object.defineProperty(n,"context",{get:function(){return t},set:function(i){t=n.Context&&i instanceof n.Context?i:new n.Context(i);n.Context&&n.Context.emit("init",t)}}),Object.defineProperty(n.prototype,"context",{get:function(){return n.context}}),n.setContext=function(t){n.context=t},Object.defineProperty(n.prototype,"blockTime",{get:function(){return 128/this.context.sampleRate}}),Object.defineProperty(n.prototype,"sampleTime",{get:function(){return 1/this.context.sampleRate}}),Object.defineProperty(n,"supported",{get:function(){var n=window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"),t=window.hasOwnProperty("Promise"),i=window.hasOwnProperty("Worker");return n&&t&&i}}),n.version="r10",!window.TONE_SILENCE_VERSION_LOGGING,n}();ki=function(n){"use strict";return n.SignalBase=function(){},n.extend(n.SignalBase),n.SignalBase.prototype.connect=function(t,i,r){return n.Signal&&n.Signal===t.constructor||n.Param&&n.Param===t.constructor||n.TimelineSignal&&n.TimelineSignal===t.constructor?(t._param.cancelScheduledValues(0),t._param.value=0,t.overridden=!0):t instanceof AudioParam&&(t.cancelScheduledValues(0),t.value=0),n.prototype.connect.call(this,t,i,r),this},n.SignalBase}(i);a=function(n){"use strict";return n.WaveShaper=function(n,t){this._shaper=this.input=this.output=this.context.createWaveShaper();this._curve=null;Array.isArray(n)?this.curve=n:isFinite(n)||this.isUndef(n)?this._curve=new Float32Array(this.defaultArg(n,1024)):this.isFunction(n)&&(this._curve=new Float32Array(this.defaultArg(t,1024)),this.setMap(n))},n.extend(n.WaveShaper,n.SignalBase),n.WaveShaper.prototype.setMap=function(n){for(var r,t=0,i=this._curve.length;t<i;t++)r=t/(i-1)*2-1,this._curve[t]=n(r,t);return this._shaper.curve=this._curve,this},Object.defineProperty(n.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(n){this._curve=new Float32Array(n);this._shaper.curve=this._curve}}),Object.defineProperty(n.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(n){if(["none","2x","4x"].indexOf(n)!==-1)this._shaper.oversample=n;else throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'");}}),n.WaveShaper.prototype.dispose=function(){return n.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},n.WaveShaper}(i);di=function(n){return n.TimeBase=function(t,i){if(this instanceof n.TimeBase)if(this._expr=this._noOp,t instanceof n.TimeBase)this.copy(t);else if(!this.isUndef(i)||this.isNumber(t)){i=this.defaultArg(i,this._defaultUnits);var r=this._primaryExpressions[i].method;this._expr=r.bind(this,t)}else this.isString(t)?this.set(t):this.isUndef(t)&&(this._expr=this._defaultExpr());else return new n.TimeBase(t,i)},n.extend(n.TimeBase),n.TimeBase.prototype.set=function(n){return this._expr=this._parseExprString(n),this},n.TimeBase.prototype.clone=function(){var n=new this.constructor;return n.copy(this),n},n.TimeBase.prototype.copy=function(n){var t=n._expr();return this.set(t)},n.TimeBase.prototype._primaryExpressions={n:{regexp:/^(\d+)n/i,method:function(n){return n=parseInt(n),n===1?this._beatsToUnits(this._timeSignature()):this._beatsToUnits(4/n)}},t:{regexp:/^(\d+)t/i,method:function(n){return n=parseInt(n),this._beatsToUnits(8/(parseInt(n)*3))}},m:{regexp:/^(\d+)m/i,method:function(n){return this._beatsToUnits(parseInt(n)*this._timeSignature())}},i:{regexp:/^(\d+)i/i,method:function(n){return this._ticksToUnits(parseInt(n))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz/i,method:function(n){return this._frequencyToUnits(parseFloat(n))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(n,t,i){var r=0;return n&&n!=="0"&&(r+=this._beatsToUnits(this._timeSignature()*parseFloat(n))),t&&t!=="0"&&(r+=this._beatsToUnits(parseFloat(t))),i&&i!=="0"&&(r+=this._beatsToUnits(parseFloat(i)/4)),r}},s:{regexp:/^(\d+(?:\.\d+)?s)/,method:function(n){return this._secondsToUnits(parseFloat(n))}},samples:{regexp:/^(\d+)samples/,method:function(n){return parseInt(n)/this.context.sampleRate}},"default":{regexp:/^(\d+(?:\.\d+)?)/,method:function(n){return this._primaryExpressions[this._defaultUnits].method.call(this,n)}}},n.TimeBase.prototype._binaryExpressions={"+":{regexp:/^\+/,precedence:2,method:function(n,t){return n()+t()}},"-":{regexp:/^\-/,precedence:2,method:function(n,t){return n()-t()}},"*":{regexp:/^\*/,precedence:1,method:function(n,t){return n()*t()}},"/":{regexp:/^\//,precedence:1,method:function(n,t){return n()/t()}}},n.TimeBase.prototype._unaryExpressions={neg:{regexp:/^\-/,method:function(n){return-n()}}},n.TimeBase.prototype._syntaxGlue={"(":{regexp:/^\(/},")":{regexp:/^\)/}},n.TimeBase.prototype._tokenize=function(n){function u(n,t){for(var u,e,f=["_binaryExpressions","_unaryExpressions","_primaryExpressions","_syntaxGlue"],r=0;r<f.length;r++){u=t[f[r]];for(e in u){var i=u[e],s=i.regexp,o=n.match(s);if(o!==null)return{method:i.method,precedence:i.precedence,regexp:i.regexp,value:o[0]}}}throw new SyntaxError("Tone.TimeBase: Unexpected token "+n);}for(var r=-1,t=[],i;n.length>0;)n=n.trim(),i=u(n,this),t.push(i),n=n.substr(i.value.length);return{next:function(){return t[++r]},peek:function(){return t[r+1]}}},n.TimeBase.prototype._matchGroup=function(n,t,i){var u,r;if(!this.isUndef(n))for(u in t)if(r=t[u],r.regexp.test(n.value)&&(this.isUndef(i)||r.precedence===i))return r;return!1},n.TimeBase.prototype._parseBinary=function(n,t){var r,i;for(this.isUndef(t)&&(t=2),r=t<0?this._parseUnary(n):this._parseBinary(n,t-1),i=n.peek();i&&this._matchGroup(i,this._binaryExpressions,t);)i=n.next(),r=i.method.bind(this,r,this._parseBinary(n,t-1)),i=n.peek();return r},n.TimeBase.prototype._parseUnary=function(n){var t,r,i;return(t=n.peek(),i=this._matchGroup(t,this._unaryExpressions),i)?(t=n.next(),r=this._parseUnary(n),i.method.bind(this,r)):this._parsePrimary(n)},n.TimeBase.prototype._parsePrimary=function(n){var t,r,i;if(t=n.peek(),this.isUndef(t))throw new SyntaxError("Tone.TimeBase: Unexpected end of expression");if(this._matchGroup(t,this._primaryExpressions))return t=n.next(),i=t.value.match(t.regexp),t.method.bind(this,i[1],i[2],i[3]);if(t&&t.value==="("){if(n.next(),r=this._parseBinary(n),t=n.next(),!(t&&t.value===")"))throw new SyntaxError("Expected )");return r}throw new SyntaxError("Tone.TimeBase: Cannot process token "+t.value);},n.TimeBase.prototype._parseExprString=function(n){this.isString(n)||(n=n.toString());var t=this._tokenize(n);return this._parseBinary(t)},n.TimeBase.prototype._noOp=function(){return 0},n.TimeBase.prototype._defaultExpr=function(){return this._noOp},n.TimeBase.prototype._defaultUnits="s",n.TimeBase.prototype._frequencyToUnits=function(n){return 1/n},n.TimeBase.prototype._beatsToUnits=function(t){return 60/n.Transport.bpm.value*t},n.TimeBase.prototype._secondsToUnits=function(n){return n},n.TimeBase.prototype._ticksToUnits=function(t){return t*(this._beatsToUnits(1)/n.Transport.PPQ)},n.TimeBase.prototype._timeSignature=function(){return n.Transport.timeSignature},n.TimeBase.prototype._pushExpr=function(t,i,r){return t instanceof n.TimeBase||(t=new this.constructor(t,r)),this._expr=this._binaryExpressions[i].method.bind(this,this._expr,t._expr),this},n.TimeBase.prototype.add=function(n,t){return this._pushExpr(n,"+",t)},n.TimeBase.prototype.sub=function(n,t){return this._pushExpr(n,"-",t)},n.TimeBase.prototype.mult=function(n,t){return this._pushExpr(n,"*",t)},n.TimeBase.prototype.div=function(n,t){return this._pushExpr(n,"/",t)},n.TimeBase.prototype.valueOf=function(){return this._expr()},n.TimeBase.prototype.dispose=function(){this._expr=null},n.TimeBase}(i);st=function(n){return n.Time=function(t,i){if(this instanceof n.Time)this._plusNow=!1,n.TimeBase.call(this,t,i);else return new n.Time(t,i)},n.extend(n.Time,n.TimeBase),n.Time.prototype._unaryExpressions=Object.create(n.TimeBase.prototype._unaryExpressions),n.Time.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(t){return n.Transport.nextSubdivision(t())}},n.Time.prototype._unaryExpressions.now={regexp:/^\+/,method:function(n){return this._plusNow=!0,n()}},n.Time.prototype.quantize=function(n,t){return t=this.defaultArg(t,1),this._expr=function(n,t,i){n=n();t=t.toSeconds();var r=Math.round(n/t),u=r*t,f=u-n;return n+f*i}.bind(this,this._expr,new this.constructor(n),t),this},n.Time.prototype.addNow=function(){return this._plusNow=!0,this},n.Time.prototype._defaultExpr=function(){return this._plusNow=!0,this._noOp},n.Time.prototype.copy=function(t){return n.TimeBase.prototype.copy.call(this,t),this._plusNow=t._plusNow,this},n.Time.prototype.toNotation=function(){var n=this.toSeconds(),t=this._toNotationHelper(n,["1m","2n","4n","8n","16n","32n","64n","128n"]),i=this._toNotationHelper(n,["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"]);return i.split("+").length<t.split("+").length?i:t},n.Time.prototype._toNotationHelper=function(n,t){for(var o=this._notationToUnits(t[t.length-1]),r="",u=0;u<t.length;u++){var f=this._notationToUnits(t[u]),i=n/f,e=1e-6;if(1-i%1<e&&(i+=e),i=Math.floor(i),i>0)if(r+=i===1?t[u]:i.toString()+"*"+t[u],n-=i*f,n<o)break;else r+=" + "}return r===""&&(r="0"),r},n.Time.prototype._notationToUnits=function(n){for(var r,u,t=this._primaryExpressions,f=[t.n,t.t,t.m],i=0;i<f.length;i++)if(r=f[i],u=n.match(r.regexp),u)return r.method.call(this,u[1])},n.Time.prototype.toBarsBeatsSixteenths=function(){var r=this._beatsToUnits(1),t=this.toSeconds()/r,u=Math.floor(t/this._timeSignature()),n=t%1*4,i;return t=Math.floor(t)%this._timeSignature(),n=n.toString(),n.length>3&&(n=parseFloat(n).toFixed(3)),i=[u,t,n],i.join(":")},n.Time.prototype.toTicks=function(){var t=this._beatsToUnits(1),i=this.valueOf()/t;return Math.floor(i*n.Transport.PPQ)},n.Time.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},n.Time.prototype.toFrequency=function(){return 1/this.toSeconds()},n.Time.prototype.toSeconds=function(){return this.valueOf()},n.Time.prototype.toMilliseconds=function(){return this.toSeconds()*1e3},n.Time.prototype.valueOf=function(){var n=this._expr();return n+(this._plusNow?this.now():0)},n.Time}(i);ht=function(n){n.Frequency=function(t,i){if(this instanceof n.Frequency)n.TimeBase.call(this,t,i);else return new n.Frequency(t,i)};n.extend(n.Frequency,n.TimeBase);n.Frequency.prototype._primaryExpressions=Object.create(n.TimeBase.prototype._primaryExpressions);n.Frequency.prototype._primaryExpressions.midi={regexp:/^(\d+(?:\.\d+)?midi)/,method:function(n){return this.midiToFrequency(n)}};n.Frequency.prototype._primaryExpressions.note={regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(n,i){var r=t[n.toLowerCase()],u=r+(parseInt(i)+1)*12;return this.midiToFrequency(u)}};n.Frequency.prototype._primaryExpressions.tr={regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(n,t,i){var r=1;return n&&n!=="0"&&(r*=this._beatsToUnits(this._timeSignature()*parseFloat(n))),t&&t!=="0"&&(r*=this._beatsToUnits(parseFloat(t))),i&&i!=="0"&&(r*=this._beatsToUnits(parseFloat(i)/4)),r}};n.Frequency.prototype.transpose=function(n){return this._expr=function(n,t){var i=n();return i*this.intervalToFrequencyRatio(t)}.bind(this,this._expr,n),this};n.Frequency.prototype.harmonize=function(n){return this._expr=function(n,t){for(var u=n(),r=[],i=0;i<t.length;i++)r[i]=u*this.intervalToFrequencyRatio(t[i]);return r}.bind(this,this._expr,n),this};n.Frequency.prototype.toMidi=function(){return this.frequencyToMidi(this.valueOf())};n.Frequency.prototype.toNote=function(){var f=this.valueOf(),e=Math.log(f/n.Frequency.A4)/Math.LN2,t=Math.round(12*e)+57,r=Math.floor(t/12),u;return r<0&&(t+=-12*r),u=i[t%12],u+r.toString()};n.Frequency.prototype.toSeconds=function(){return 1/this.valueOf()};n.Frequency.prototype.toFrequency=function(){return this.valueOf()};n.Frequency.prototype.toTicks=function(){var t=this._beatsToUnits(1),i=this.valueOf()/t;return Math.floor(i*n.Transport.PPQ)};n.Frequency.prototype._frequencyToUnits=function(n){return n};n.Frequency.prototype._ticksToUnits=function(t){return 1/(t*60/(n.Transport.bpm.value*n.Transport.PPQ))};n.Frequency.prototype._beatsToUnits=function(t){return 1/n.TimeBase.prototype._beatsToUnits.call(this,t)};n.Frequency.prototype._secondsToUnits=function(n){return 1/n};n.Frequency.prototype._defaultUnits="hz";var t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return n.Frequency.A4=440,n.Frequency.prototype.midiToFrequency=function(t){return n.Frequency.A4*Math.pow(2,(t-69)/12)},n.Frequency.prototype.frequencyToMidi=function(t){return 69+12*Math.log(t/n.Frequency.A4)/Math.LN2},n.Frequency}(i);ct=function(n){return n.TransportTime=function(t,i){if(this instanceof n.TransportTime)n.Time.call(this,t,i);else return new n.TransportTime(t,i)},n.extend(n.TransportTime,n.Time),n.TransportTime.prototype._unaryExpressions=Object.create(n.Time.prototype._unaryExpressions),n.TransportTime.prototype._unaryExpressions.quantize={regexp:/^@/,method:function(t){var i=this._secondsToTicks(t()),r=Math.ceil(n.Transport.ticks/i);return this._ticksToUnits(r*i)}},n.TransportTime.prototype._secondsToTicks=function(t){var i=this._beatsToUnits(1),r=t/i;return Math.round(r*n.Transport.PPQ)},n.TransportTime.prototype.valueOf=function(){var t=this._secondsToTicks(this._expr());return t+(this._plusNow?n.Transport.ticks:0)},n.TransportTime.prototype.toTicks=function(){return this.valueOf()},n.TransportTime.prototype.toSeconds=function(){var t=this._expr();return t+(this._plusNow?n.Transport.seconds:0)},n.TransportTime.prototype.toFrequency=function(){return 1/this.toSeconds()},n.TransportTime}(i);lt=function(n){"use strict";return n.Emitter=function(){this._events={}},n.extend(n.Emitter),n.Emitter.prototype.on=function(n,t){for(var i,u=n.split(/\W+/),r=0;r<u.length;r++)i=u[r],this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(t);return this},n.Emitter.prototype.off=function(t,i){for(var u,r,e=t.split(/\W+/),f=0;f<e.length;f++)if(t=e[f],this._events.hasOwnProperty(t))if(n.prototype.isUndef(i))this._events[t]=[];else for(u=this._events[t],r=0;r<u.length;r++)u[r]===i&&u.splice(r,1);return this},n.Emitter.prototype.emit=function(n){var r,i,t,u;if(this._events&&(r=Array.apply(null,arguments).slice(1),this._events.hasOwnProperty(n)))for(i=this._events[n],t=0,u=i.length;t<u;t++)i[t].apply(this,r);return this},n.Emitter.mixin=function(t){var u=["on","off","emit"],i,r,f;for(t._events={},i=0;i<u.length;i++)r=u[i],f=n.Emitter.prototype[r],t[r]=f},n.Emitter.prototype.dispose=function(){return n.prototype.dispose.call(this),this._events=null,this},n.Emitter}(i);gi=function(n){function t(){function i(i,r,u){if(i.input)Array.isArray(i.input)?(n.prototype.isUndef(u)&&(u=0),this.connect(i.input[u])):this.connect(i.input,r,u);else try{i instanceof AudioNode?t.call(this,i,r,u):t.call(this,i,r)}catch(f){throw new Error("error connecting to node: "+i+"\n"+f);}}function u(t,i,u){if(t&&t.input&&Array.isArray(t.input))n.prototype.isUndef(u)&&(u=0),this.disconnect(t.input[u],i,u);else if(t&&t.input)this.disconnect(t.input,i,u);else try{r.apply(this,arguments)}catch(f){throw new Error("error disconnecting node: "+t+"\n"+f);}}var t=AudioNode.prototype.connect,r=AudioNode.prototype.disconnect;AudioNode.prototype.connect!==i&&(AudioNode.prototype.connect=i,AudioNode.prototype.disconnect=u)}return!window.hasOwnProperty("AudioContext")&&window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext),n.Context=function(t){n.Emitter.call(this);t||(t=new window.AudioContext);this._context=t;for(var i in this._context)this._defineProperty(this._context,i);this._latencyHint="interactive";this._lookAhead=.1;this._updateInterval=this._lookAhead/3;this._computedUpdateInterval=0;this._worker=this._createWorker();this._constants={}},n.extend(n.Context,n.Emitter),n.Emitter.mixin(n.Context),n.Context.prototype._defineProperty=function(n,t){this.isUndef(this[t])&&Object.defineProperty(this,t,{get:function(){return typeof n[t]=="function"?n[t].bind(n):n[t]},set:function(i){n[t]=i}})},n.Context.prototype.now=function(){return this._context.currentTime},n.Context.prototype._createWorker=function(){window.URL=window.URL||window.webkitURL;var t=new Blob(["var timeoutTime = "+(this._updateInterval*1e3).toFixed(1)+";self.onmessage = function(msg){\ttimeoutTime = parseInt(msg.data);};function tick(){\tsetTimeout(tick, timeoutTime);\tself.postMessage('tick');}tick();"]),i=URL.createObjectURL(t),n=new Worker(i);return n.addEventListener("message",function(){this.emit("tick")}.bind(this)),n.addEventListener("message",function(){var n=this.now(),t;this.isNumber(this._lastUpdate)&&(t=n-this._lastUpdate,this._computedUpdateInterval=Math.max(t,this._computedUpdateInterval*.97));this._lastUpdate=n}.bind(this)),n},n.Context.prototype.getConstant=function(n){var r,u,i,t;if(this._constants[n])return this._constants[n];for(r=this._context.createBuffer(1,128,this._context.sampleRate),u=r.getChannelData(0),i=0;i<u.length;i++)u[i]=n;return t=this._context.createBufferSource(),t.channelCount=1,t.channelCountMode="explicit",t.buffer=r,t.loop=!0,t.start(0),this._constants[n]=t,t},Object.defineProperty(n.Context.prototype,"lag",{get:function(){var n=this._computedUpdateInterval-this._updateInterval;return Math.max(n,0)}}),Object.defineProperty(n.Context.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(n){this._lookAhead=n}}),Object.defineProperty(n.Context.prototype,"updateInterval",{get:function(){return this._updateInterval},set:function(t){this._updateInterval=Math.max(t,n.prototype.blockTime);this._worker.postMessage(Math.max(t*1e3,1))}}),Object.defineProperty(n.Context.prototype,"latencyHint",{get:function(){return this._latencyHint},set:function(n){var t=n;if(this._latencyHint=n,this.isString(n))switch(n){case"interactive":t=.1;this._context.latencyHint=n;break;case"playback":t=.8;this._context.latencyHint=n;break;case"balanced":t=.25;this._context.latencyHint=n;break;case"fastest":t=.01}this.lookAhead=t;this.updateInterval=t/3}}),n.supported?(t(),n.context=new n.Context):console.warn("This browser does not support Tone.js"),n.Context}(i);at=function(n){return n.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"},n.prototype.toSeconds=function(t){return this.isNumber(t)?t:this.isUndef(t)?this.now():this.isString(t)?new n.Time(t).toSeconds():t instanceof n.TimeBase?t.toSeconds():void 0},n.prototype.toFrequency=function(t){return this.isNumber(t)?t:this.isString(t)||this.isUndef(t)?new n.Frequency(t).valueOf():t instanceof n.TimeBase?t.toFrequency():void 0},n.prototype.toTicks=function(t){return this.isNumber(t)||this.isString(t)?new n.TransportTime(t).toTicks():this.isUndef(t)?n.Transport.ticks:t instanceof n.TimeBase?t.toTicks():void 0},n}(i,st,ht,ct);w=function(n){"use strict";return n.Param=function(){var t=this.optionsObject(arguments,["param","units","convert"],n.Param.defaults);this._param=this.input=t.param;this.units=t.units;this.convert=t.convert;this.overridden=!1;this._lfo=null;this.isObject(t.lfo)?this.value=t.lfo:this.isUndef(t.value)||(this.value=t.value)},n.extend(n.Param),n.Param.defaults={units:n.Type.Default,convert:!0,param:undefined},Object.defineProperty(n.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(t){if(this.isObject(t)){if(this.isUndef(n.LFO))throw new Error("Include 'Tone.LFO' to use an LFO as a Param value.");this._lfo&&this._lfo.dispose();this._lfo=new n.LFO(t).start();this._lfo.connect(this.input)}else{var i=this._fromUnits(t);this._param.cancelScheduledValues(0);this._param.value=i}}}),n.Param.prototype._fromUnits=function(t){if(this.convert||this.isUndef(this.convert))switch(this.units){case n.Type.Time:return this.toSeconds(t);case n.Type.Frequency:return this.toFrequency(t);case n.Type.Decibels:return this.dbToGain(t);case n.Type.NormalRange:return Math.min(Math.max(t,0),1);case n.Type.AudioRange:return Math.min(Math.max(t,-1),1);case n.Type.Positive:return Math.max(t,0);default:return t}else return t},n.Param.prototype._toUnits=function(t){if(this.convert||this.isUndef(this.convert))switch(this.units){case n.Type.Decibels:return this.gainToDb(t);default:return t}else return t},n.Param.prototype._minOutput=1e-5,n.Param.prototype.setValueAtTime=function(n,t){return n=this._fromUnits(n),t=this.toSeconds(t),t<=this.now()+this.blockTime?this._param.value=n:this._param.setValueAtTime(n,t),this},n.Param.prototype.setRampPoint=function(n){n=this.defaultArg(n,this.now());var t=this._param.value;return t===0&&(t=this._minOutput),this._param.setValueAtTime(t,n),this},n.Param.prototype.linearRampToValueAtTime=function(n,t){return n=this._fromUnits(n),this._param.linearRampToValueAtTime(n,this.toSeconds(t)),this},n.Param.prototype.exponentialRampToValueAtTime=function(n,t){return n=this._fromUnits(n),n=Math.max(this._minOutput,n),this._param.exponentialRampToValueAtTime(n,this.toSeconds(t)),this},n.Param.prototype.exponentialRampToValue=function(n,t,i){return i=this.toSeconds(i),this.setRampPoint(i),this.exponentialRampToValueAtTime(n,i+this.toSeconds(t)),this},n.Param.prototype.linearRampToValue=function(n,t,i){return i=this.toSeconds(i),this.setRampPoint(i),this.linearRampToValueAtTime(n,i+this.toSeconds(t)),this},n.Param.prototype.setTargetAtTime=function(n,t,i){return n=this._fromUnits(n),n=Math.max(this._minOutput,n),i=Math.max(this._minOutput,i),this._param.setTargetAtTime(n,this.toSeconds(t),i),this},n.Param.prototype.setValueCurveAtTime=function(n,t,i){for(var r=0;r<n.length;r++)n[r]=this._fromUnits(n[r]);return this._param.setValueCurveAtTime(n,this.toSeconds(t),this.toSeconds(i)),this},n.Param.prototype.cancelScheduledValues=function(n){return this._param.cancelScheduledValues(this.toSeconds(n)),this},n.Param.prototype.rampTo=function(t,i,r){return i=this.defaultArg(i,0),this.units===n.Type.Frequency||this.units===n.Type.BPM||this.units===n.Type.Decibels?this.exponentialRampToValue(t,i,r):this.linearRampToValue(t,i,r),this},Object.defineProperty(n.Param.prototype,"lfo",{get:function(){return this._lfo}}),n.Param.prototype.dispose=function(){return n.prototype.dispose.call(this),this._param=null,this._lfo&&(this._lfo.dispose(),this._lfo=null),this},n.Param}(i);nr=function(n){"use strict";return window.GainNode&&!AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),n.Gain=function(){var t=this.optionsObject(arguments,["gain","units"],n.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain();this.gain=new n.Param({param:this._gainNode.gain,units:t.units,value:t.gain,convert:t.convert});this._readOnly("gain")},n.extend(n.Gain),n.Gain.defaults={gain:1,convert:!0},n.Gain.prototype.dispose=function(){n.Param.prototype.dispose.call(this);this._gainNode.disconnect();this._gainNode=null;this._writable("gain");this.gain.dispose();this.gain=null},n.prototype.createInsOuts=function(t,i){t===1?this.input=new n.Gain:t>1&&(this.input=new Array(t));i===1?this.output=new n.Gain:i>1&&(this.output=new Array(t))},n.Gain}(i,w);e=function(n){"use strict";return n.Signal=function(){var t=this.optionsObject(arguments,["value","units"],n.Signal.defaults);this.output=this._gain=this.context.createGain();t.param=this._gain.gain;n.Param.call(this,t);this.input=this._param=this._gain.gain;this.context.getConstant(1).chain(this._gain)},n.extend(n.Signal,n.Param),n.Signal.defaults={value:0,units:n.Type.Default,convert:!0},n.Signal.prototype.connect=n.SignalBase.prototype.connect,n.Signal.prototype.dispose=function(){return n.Param.prototype.dispose.call(this),this._param=null,this._gain.disconnect(),this._gain=null,this},n.Signal}(i,a,at,w);f=function(n){"use strict";return n.Add=function(t){this.createInsOuts(2,0);this._sum=this.input[0]=this.input[1]=this.output=new n.Gain;this._param=this.input[1]=new n.Signal(t);this._param.connect(this._sum)},n.extend(n.Add,n.Signal),n.Add.prototype.dispose=function(){return n.prototype.dispose.call(this),this._sum.dispose(),this._sum=null,this._param.dispose(),this._param=null,this},n.Add}(i,e);u=function(n){"use strict";return n.Multiply=function(t){this.createInsOuts(2,0);this._mult=this.input[0]=this.output=new n.Gain;this._param=this.input[1]=this.output.gain;this._param.value=this.defaultArg(t,0)},n.extend(n.Multiply,n.Signal),n.Multiply.prototype.dispose=function(){return n.prototype.dispose.call(this),this._mult.dispose(),this._mult=null,this._param=null,this},n.Multiply}(i,e);h=function(n){"use strict";return n.Scale=function(t,i){this._outputMin=this.defaultArg(t,0);this._outputMax=this.defaultArg(i,1);this._scale=this.input=new n.Multiply(1);this._add=this.output=new n.Add(0);this._scale.connect(this._add);this._setRange()},n.extend(n.Scale,n.SignalBase),Object.defineProperty(n.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(n){this._outputMin=n;this._setRange()}}),Object.defineProperty(n.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(n){this._outputMax=n;this._setRange()}}),n.Scale.prototype._setRange=function(){this._add.value=this._outputMin;this._scale.value=this._outputMax-this._outputMin},n.Scale.prototype.dispose=function(){return n.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},n.Scale}(i,f,u);vt=function(){var r=e,o=f,s=u,c=h,l=i,a=t;l.setContext(a.audiocontext);n.Signal=function(n){return new r(n)};r.prototype.fade=r.prototype.linearRampToValueAtTime;s.prototype.fade=r.prototype.fade;o.prototype.fade=r.prototype.fade;c.prototype.fade=r.prototype.fade;r.prototype.setInput=function(n){n.connect(this)};s.prototype.setInput=r.prototype.setInput;o.prototype.setInput=r.prototype.setInput;c.prototype.setInput=r.prototype.setInput;r.prototype.add=function(n){var t=new o(n);return this.connect(t),t};s.prototype.add=r.prototype.add;o.prototype.add=r.prototype.add;c.prototype.add=r.prototype.add;r.prototype.mult=function(n){var t=new s(n);return this.connect(t),t};s.prototype.mult=r.prototype.mult;o.prototype.mult=r.prototype.mult;c.prototype.mult=r.prototype.mult;r.prototype.scale=function(t,i,r,u){var f,e,o;return arguments.length===4?(f=n.prototype.map(r,t,i,0,1)-.5,e=n.prototype.map(u,t,i,0,1)-.5):(f=arguments[0],e=arguments[1]),o=new c(f,e),this.connect(o),o};s.prototype.scale=r.prototype.scale;o.prototype.scale=r.prototype.scale;c.prototype.scale=r.prototype.scale}(e,f,u,h,i,t);b=function(){var i=t,e=f,o=u,s=h,r;n.Oscillator=function(t,r){var u;typeof t=="string"&&(u=r,r=t,t=u);typeof r=="number"&&(u=r,r=t,t=u);this.started=!1;this.phaseAmount=undefined;this.oscillator=i.audiocontext.createOscillator();this.f=t||440;this.oscillator.type=r||"sine";this.oscillator.frequency.setValueAtTime(this.f,i.audiocontext.currentTime);this.output=i.audiocontext.createGain();this._freqMods=[];this.output.gain.value=.5;this.output.gain.setValueAtTime(.5,i.audiocontext.currentTime);this.oscillator.connect(this.output);this.panPosition=0;this.connection=i.input;this.panner=new n.Panner(this.output,this.connection,1);this.mathOps=[this.output];i.soundArray.push(this)};n.Oscillator.prototype.start=function(n,t){var u,f,e,r;if(this.started&&(u=i.audiocontext.currentTime,this.stop(u)),!this.started){f=t||this.f;e=this.oscillator.type;this.oscillator&&(this.oscillator.disconnect(),this.oscillator=undefined);this.oscillator=i.audiocontext.createOscillator();this.oscillator.frequency.value=Math.abs(f);this.oscillator.type=e;this.oscillator.connect(this.output);n=n||0;this.oscillator.start(n+i.audiocontext.currentTime);this.freqNode=this.oscillator.frequency;for(r in this._freqMods)typeof this._freqMods[r].connect!="undefined"&&this._freqMods[r].connect(this.oscillator.frequency);this.started=!0}};n.Oscillator.prototype.stop=function(n){if(this.started){var t=n||0,r=i.audiocontext.currentTime;this.oscillator.stop(t+r);this.started=!1}};n.Oscillator.prototype.amp=function(n,t,r){var u=this;if(typeof n=="number"){var t=t||0,r=r||0,f=i.audiocontext.currentTime;this.output.gain.linearRampToValueAtTime(n,f+r+t)}else if(n)n.connect(u.output.gain);else return this.output.gain};n.Oscillator.prototype.fade=n.Oscillator.prototype.amp;n.Oscillator.prototype.getAmp=function(){return this.output.gain.value};n.Oscillator.prototype.freq=function(n,t,r){if(typeof n!="number"||isNaN(n))if(n)n.output&&(n=n.output),n.connect(this.oscillator.frequency),this._freqMods.push(n);else return this.oscillator.frequency;else{this.f=n;var u=i.audiocontext.currentTime,t=t||0,r=r||0,f=u+r+t;t===0?this.oscillator.frequency.setValueAtTime(n,r+u):n>0?this.oscillator.frequency.exponentialRampToValueAtTime(n,r+t+u):this.oscillator.frequency.linearRampToValueAtTime(n,r+t+u);this.phaseAmount&&this.phase(this.phaseAmount)}};n.Oscillator.prototype.getFreq=function(){return this.oscillator.frequency.value};n.Oscillator.prototype.setType=function(n){this.oscillator.type=n};n.Oscillator.prototype.getType=function(){return this.oscillator.type};n.Oscillator.prototype.connect=function(n){n?n.hasOwnProperty("input")?(this.panner.connect(n.input),this.connection=n.input):(this.panner.connect(n),this.connection=n):this.panner.connect(i.input)};n.Oscillator.prototype.disconnect=function(){this.output.disconnect();this.panner.disconnect();this.output.connect(this.panner);this.oscMods=[]};n.Oscillator.prototype.pan=function(n,t){this.panPosition=n;this.panner.pan(n,t)};n.Oscillator.prototype.getPan=function(){return this.panPosition};n.Oscillator.prototype.dispose=function(){var t=i.soundArray.indexOf(this),n;i.soundArray.splice(t,1);this.oscillator&&(n=i.audiocontext.currentTime,this.stop(n),this.disconnect(),this.panner=null,this.oscillator=null);this.osc2&&this.osc2.dispose()};n.Oscillator.prototype.phase=function(t){var r=n.prototype.map(t,0,1,0,1/this.f),u=i.audiocontext.currentTime;this.phaseAmount=t;this.dNode||(this.dNode=i.audiocontext.createDelay(),this.oscillator.disconnect(),this.oscillator.connect(this.dNode),this.dNode.connect(this.output));this.dNode.delayTime.setValueAtTime(r,u)};r=function(n,t,i,r,u){var e=n.oscillator;for(var f in n.mathOps)n.mathOps[f]instanceof u&&(e.disconnect(),n.mathOps[f].dispose(),i=f,i<n.mathOps.length-2&&(r=n.mathOps[f+1]));return i===n.mathOps.length-1&&n.mathOps.push(r),f>0&&(e=n.mathOps[f-1]),e.disconnect(),e.connect(t),t.connect(r),n.mathOps[i]=t,n};n.Oscillator.prototype.add=function(n){var t=new e(n),i=this.mathOps.length-1,u=this.output;return r(this,t,i,u,e)};n.Oscillator.prototype.mult=function(n){var t=new o(n),i=this.mathOps.length-1,u=this.output;return r(this,t,i,u,o)};n.Oscillator.prototype.scale=function(t,i,u,f){var e,o;arguments.length===4?(e=n.prototype.map(u,t,i,0,1)-.5,o=n.prototype.map(f,t,i,0,1)-.5):(e=arguments[0],o=arguments[1]);var h=new s(e,o),c=this.mathOps.length-1,l=this.output;return r(this,h,c,l,s)};n.SinOsc=function(t){n.Oscillator.call(this,t,"sine")};n.SinOsc.prototype=Object.create(n.Oscillator.prototype);n.TriOsc=function(t){n.Oscillator.call(this,t,"triangle")};n.TriOsc.prototype=Object.create(n.Oscillator.prototype);n.SawOsc=function(t){n.Oscillator.call(this,t,"sawtooth")};n.SawOsc.prototype=Object.create(n.Oscillator.prototype);n.SqrOsc=function(t){n.Oscillator.call(this,t,"square")};n.SqrOsc.prototype=Object.create(n.Oscillator.prototype)}(t,f,u,h);yt=function(n){"use strict";return n.Timeline=function(){var t=this.optionsObject(arguments,["memory"],n.Timeline.defaults);this._timeline=[];this._toRemove=[];this._iterating=!1;this.memory=t.memory},n.extend(n.Timeline),n.Timeline.defaults={memory:Infinity},Object.defineProperty(n.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),n.Timeline.prototype.add=function(n){var t,i;if(this.isUndef(n.time))throw new Error("Tone.Timeline: events must have a time attribute");return this._timeline.length?(t=this._search(n.time),this._timeline.splice(t+1,0,n)):this._timeline.push(n),this.length>this.memory&&(i=this.length-this.memory,this._timeline.splice(0,i)),this},n.Timeline.prototype.remove=function(n){if(this._iterating)this._toRemove.push(n);else{var t=this._timeline.indexOf(n);t!==-1&&this._timeline.splice(t,1)}return this},n.Timeline.prototype.get=function(n){var t=this._search(n);return t!==-1?this._timeline[t]:null},n.Timeline.prototype.peek=function(){return this._timeline[0]},n.Timeline.prototype.shift=function(){return this._timeline.shift()},n.Timeline.prototype.getAfter=function(n){var t=this._search(n);return t+1<this._timeline.length?this._timeline[t+1]:null},n.Timeline.prototype.getBefore=function(n){var t=this._timeline.length,i;return t>0&&this._timeline[t-1].time<n?this._timeline[t-1]:(i=this._search(n),i-1>=0?this._timeline[i-1]:null)},n.Timeline.prototype.cancel=function(n){var t,i;if(this._timeline.length>1)if(t=this._search(n),t>=0)if(this._timeline[t].time===n){for(i=t;i>=0;i--)if(this._timeline[i].time===n)t=i;else break;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[];else this._timeline.length===1&&this._timeline[0].time>=n&&(this._timeline=[]);return this},n.Timeline.prototype.cancelBefore=function(n){if(this._timeline.length){var t=this._search(n);t>=0&&(this._timeline=this._timeline.slice(t+1))}return this},n.Timeline.prototype._search=function(n){var r=0,u=this._timeline.length,e=u,i,o;if(u>0&&this._timeline[u-1].time<=n)return u-1;while(r<e){var t=Math.floor(r+(e-r)/2),f=this._timeline[t],s=this._timeline[t+1];if(f.time===n){for(i=t;i<this._timeline.length;i++)o=this._timeline[i],o.time===n&&(t=i);return t}if(f.time<n&&s.time>n)return t;f.time>n?e=t:f.time<n&&(r=t+1)}return-1},n.Timeline.prototype._iterate=function(n,t,i){var r,u,f;for(this._iterating=!0,t=this.defaultArg(t,0),i=this.defaultArg(i,this._timeline.length-1),r=t;r<=i;r++)n(this._timeline[r]);if(this._iterating=!1,this._toRemove.length>0){for(u=0;u<this._toRemove.length;u++)f=this._timeline.indexOf(this._toRemove[u]),f!==-1&&this._timeline.splice(f,1);this._toRemove=[]}},n.Timeline.prototype.forEach=function(n){return this._iterate(n),this},n.Timeline.prototype.forEachBefore=function(n,t){var i=this._search(n);return i!==-1&&this._iterate(t,0,i),this},n.Timeline.prototype.forEachAfter=function(n,t){var i=this._search(n);return this._iterate(t,i+1),this},n.Timeline.prototype.forEachFrom=function(n,t){for(var i=this._search(n);i>=0&&this._timeline[i].time>=n;)i--;return this._iterate(t,i+1),this},n.Timeline.prototype.forEachAtTime=function(n,t){var i=this._search(n);return i!==-1&&this._iterate(function(i){i.time===n&&t(i)},0,i),this},n.Timeline.prototype.dispose=function(){n.prototype.dispose.call(this);this._timeline=null;this._toRemove=null},n.Timeline}(i);c=function(n){"use strict";return n.TimelineSignal=function(){var t=this.optionsObject(arguments,["value","units"],n.Signal.defaults);this._events=new n.Timeline(10);n.Signal.apply(this,t);t.param=this._param;n.Param.call(this,t);this._initial=this._fromUnits(this._param.value)},n.extend(n.TimelineSignal,n.Param),n.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Curve:"curve",Set:"set"},Object.defineProperty(n.TimelineSignal.prototype,"value",{get:function(){var n=this.now(),t=this.getValueAtTime(n);return this._toUnits(t)},set:function(n){var t=this._fromUnits(n);this._initial=t;this.cancelScheduledValues();this._param.value=t}}),n.TimelineSignal.prototype.setValueAtTime=function(t,i){return t=this._fromUnits(t),i=this.toSeconds(i),this._events.add({type:n.TimelineSignal.Type.Set,value:t,time:i}),this._param.setValueAtTime(t,i),this},n.TimelineSignal.prototype.linearRampToValueAtTime=function(t,i){return t=this._fromUnits(t),i=this.toSeconds(i),this._events.add({type:n.TimelineSignal.Type.Linear,value:t,time:i}),this._param.linearRampToValueAtTime(t,i),this},n.TimelineSignal.prototype.exponentialRampToValueAtTime=function(t,i){var r,u;return i=this.toSeconds(i),r=this._searchBefore(i),r&&r.value===0&&this.setValueAtTime(this._minOutput,r.time),t=this._fromUnits(t),u=Math.max(t,this._minOutput),this._events.add({type:n.TimelineSignal.Type.Exponential,value:u,time:i}),t<this._minOutput?(this._param.exponentialRampToValueAtTime(this._minOutput,i-this.sampleTime),this.setValueAtTime(0,i)):this._param.exponentialRampToValueAtTime(t,i),this},n.TimelineSignal.prototype.setTargetAtTime=function(t,i,r){return t=this._fromUnits(t),t=Math.max(this._minOutput,t),r=Math.max(this._minOutput,r),i=this.toSeconds(i),this._events.add({type:n.TimelineSignal.Type.Target,value:t,time:i,constant:r}),this._param.setTargetAtTime(t,i,r),this},n.TimelineSignal.prototype.setValueCurveAtTime=function(t,i,r,u){var f,e,o,s;for(u=this.defaultArg(u,1),f=new Array(t.length),e=0;e<f.length;e++)f[e]=this._fromUnits(t[e])*u;for(i=this.toSeconds(i),r=this.toSeconds(r),this._events.add({type:n.TimelineSignal.Type.Curve,value:f,time:i,duration:r}),this._param.setValueAtTime(f[0],i),o=1;o<f.length;o++)s=i+o/(f.length-1)*r,this._param.linearRampToValueAtTime(f[o],s);return this},n.TimelineSignal.prototype.cancelScheduledValues=function(n){return n=this.toSeconds(n),this._events.cancel(n),this._param.cancelScheduledValues(n),this},n.TimelineSignal.prototype.setRampPoint=function(t){var r,i,u;return t=this.toSeconds(t),r=this._toUnits(this.getValueAtTime(t)),i=this._searchBefore(t),i&&i.time===t?this.cancelScheduledValues(t+this.sampleTime):i&&i.type===n.TimelineSignal.Type.Curve&&i.time+i.duration>t?(this.cancelScheduledValues(t),this.linearRampToValueAtTime(r,t)):(u=this._searchAfter(t),u&&(this.cancelScheduledValues(t),u.type===n.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(r,t):u.type===n.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(r,t)),this.setValueAtTime(r,t)),this},n.TimelineSignal.prototype.linearRampToValueBetween=function(n,t,i){return this.setRampPoint(t),this.linearRampToValueAtTime(n,i),this},n.TimelineSignal.prototype.exponentialRampToValueBetween=function(n,t,i){return this.setRampPoint(t),this.exponentialRampToValueAtTime(n,i),this},n.TimelineSignal.prototype._searchBefore=function(n){return this._events.get(n)},n.TimelineSignal.prototype._searchAfter=function(n){return this._events.getAfter(n)},n.TimelineSignal.prototype.getValueAtTime=function(t){var f,e;t=this.toSeconds(t);var r=this._searchAfter(t),i=this._searchBefore(t),u=this._initial;return i===null?u=this._initial:i.type===n.TimelineSignal.Type.Target?(f=this._events.getBefore(i.time),e=f===null?this._initial:f.value,u=this._exponentialApproach(i.time,e,i.value,i.constant,t)):u=i.type===n.TimelineSignal.Type.Curve?this._curveInterpolate(i.time,i.value,i.duration,t):r===null?i.value:r.type===n.TimelineSignal.Type.Linear?this._linearInterpolate(i.time,i.value,r.time,r.value,t):r.type===n.TimelineSignal.Type.Exponential?this._exponentialInterpolate(i.time,i.value,r.time,r.value,t):i.value,u},n.TimelineSignal.prototype.connect=n.SignalBase.prototype.connect,n.TimelineSignal.prototype._exponentialApproach=function(n,t,i,r,u){return i+(t-i)*Math.exp(-(u-n)/r)},n.TimelineSignal.prototype._linearInterpolate=function(n,t,i,r,u){return t+(r-t)*((u-n)/(i-n))},n.TimelineSignal.prototype._exponentialInterpolate=function(n,t,i,r,u){return t=Math.max(this._minOutput,t),t*Math.pow(r/t,(u-n)/(i-n))},n.TimelineSignal.prototype._curveInterpolate=function(n,t,i,r){var u=t.length;if(r>=n+i)return t[u-1];if(r<=n)return t[0];var f=(r-n)/i,e=Math.floor((u-1)*f),o=Math.ceil((u-1)*f),s=t[e],h=t[o];return o===e?s:this._linearInterpolate(e,s,o,h,f*(u-1))},n.TimelineSignal.prototype.dispose=function(){n.Signal.prototype.dispose.call(this);n.Param.prototype.dispose.call(this);this._events.dispose();this._events=null},n.TimelineSignal}(i,e);pt=function(){var r=t,e=f,o=u,s=h,l=c,a=i;a.setContext(r.audiocontext);n.Env=function(n,t,i,u,f,e){this.aTime=n||.1;this.aLevel=t||1;this.dTime=i||.5;this.dLevel=u||0;this.rTime=f||0;this.rLevel=e||0;this._rampHighPercentage=.98;this._rampLowPercentage=.02;this.output=r.audiocontext.createGain();this.control=new l;this._init();this.control.connect(this.output);this.connection=null;this.mathOps=[this.control];this.isExponential=!1;this.sourceToClear=null;this.wasTriggered=!1;r.soundArray.push(this)};n.Env.prototype._init=function(){var n=r.audiocontext.currentTime,t=n;this.control.setTargetAtTime(1e-5,t,.001);this._setRampAD(this.aTime,this.dTime)};n.Env.prototype.set=function(n,t,i,r,u,f){this.aTime=n;this.aLevel=t;this.dTime=i||0;this.dLevel=r||0;this.rTime=u||0;this.rLevel=f||0;this._setRampAD(n,i)};n.Env.prototype.setADSR=function(n,t,i,r){this.aTime=n;this.dTime=t||0;this.sPercent=i||0;this.dLevel=typeof i!="undefined"?i*(this.aLevel-this.rLevel)+this.rLevel:0;this.rTime=r||0;this._setRampAD(n,t)};n.Env.prototype.setRange=function(n,t){this.aLevel=n||1;this.rLevel=t||0};n.Env.prototype._setRampAD=function(n,t){this._rampAttackTime=this.checkExpInput(n);this._rampDecayTime=this.checkExpInput(t);var i=1;i=Math.log(1/this.checkExpInput(1-this._rampHighPercentage));this._rampAttackTC=n/this.checkExpInput(i);i=Math.log(1/this._rampLowPercentage);this._rampDecayTC=t/this.checkExpInput(i)};n.Env.prototype.setRampPercentages=function(n,t){this._rampHighPercentage=this.checkExpInput(n);this._rampLowPercentage=this.checkExpInput(t);var i=1;i=Math.log(1/this.checkExpInput(1-this._rampHighPercentage));this._rampAttackTC=this._rampAttackTime/this.checkExpInput(i);i=Math.log(1/this._rampLowPercentage);this._rampDecayTC=this._rampDecayTime/this.checkExpInput(i)};n.Env.prototype.setInput=function(){for(var n=0;n<arguments.length;n++)this.connect(arguments[n])};n.Env.prototype.setExp=function(n){this.isExponential=n};n.Env.prototype.checkExpInput=function(n){return n<=0&&(n=1e-8),n};n.Env.prototype.play=function(n,t,i){var r=t||0,i=i||0;n&&this.connection!==n&&this.connect(n);this.triggerAttack(n,r);this.triggerRelease(n,r+this.aTime+this.dTime+i)};n.Env.prototype.triggerAttack=function(n,t){var f=r.audiocontext.currentTime,e=t||0,i=f+e,u;this.lastAttack=i;this.wasTriggered=!0;n&&this.connection!==n&&this.connect(n);u=this.control.getValueAtTime(i);this.isExponential===!0?this.control.exponentialRampToValueAtTime(this.checkExpInput(u),i):this.control.linearRampToValueAtTime(u,i);i+=this.aTime;this.isExponential===!0?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.aLevel),i),u=this.checkExpInput(this.control.getValueAtTime(i)),this.control.cancelScheduledValues(i),this.control.exponentialRampToValueAtTime(u,i)):(this.control.linearRampToValueAtTime(this.aLevel,i),u=this.control.getValueAtTime(i),this.control.cancelScheduledValues(i),this.control.linearRampToValueAtTime(u,i));i+=this.dTime;this.isExponential===!0?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.dLevel),i),u=this.checkExpInput(this.control.getValueAtTime(i)),this.control.cancelScheduledValues(i),this.control.exponentialRampToValueAtTime(u,i)):(this.control.linearRampToValueAtTime(this.dLevel,i),u=this.control.getValueAtTime(i),this.control.cancelScheduledValues(i),this.control.linearRampToValueAtTime(u,i))};n.Env.prototype.triggerRelease=function(n,t){var u;if(this.wasTriggered){var f=r.audiocontext.currentTime,e=t||0,i=f+e;n&&this.connection!==n&&this.connect(n);u=this.control.getValueAtTime(i);this.isExponential===!0?this.control.exponentialRampToValueAtTime(this.checkExpInput(u),i):this.control.linearRampToValueAtTime(u,i);i+=this.rTime;this.isExponential===!0?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.rLevel),i),u=this.checkExpInput(this.control.getValueAtTime(i)),this.control.cancelScheduledValues(i),this.control.exponentialRampToValueAtTime(u,i)):(this.control.linearRampToValueAtTime(this.rLevel,i),u=this.control.getValueAtTime(i),this.control.cancelScheduledValues(i),this.control.linearRampToValueAtTime(u,i));this.wasTriggered=!1}};n.Env.prototype.ramp=function(n,t,i,u){var h=r.audiocontext.currentTime,c=t||0,f=h+c,e=this.checkExpInput(i),o=typeof u!="undefined"?this.checkExpInput(u):undefined,s;(n&&this.connection!==n&&this.connect(n),s=this.checkExpInput(this.control.getValueAtTime(f)),e>s?(this.control.setTargetAtTime(e,f,this._rampAttackTC),f+=this._rampAttackTime):e<s&&(this.control.setTargetAtTime(e,f,this._rampDecayTC),f+=this._rampDecayTime),o!==undefined)&&(o>e?this.control.setTargetAtTime(o,f,this._rampAttackTC):o<e&&this.control.setTargetAtTime(o,f,this._rampDecayTC))};n.Env.prototype.connect=function(t){this.connection=t;(t instanceof n.Oscillator||t instanceof n.SoundFile||t instanceof n.AudioIn||t instanceof n.Reverb||t instanceof n.Noise||t instanceof n.Filter||t instanceof n.Delay)&&(t=t.output.gain);t instanceof AudioParam&&t.setValueAtTime(0,r.audiocontext.currentTime);t instanceof n.Signal&&t.setValue(0);this.output.connect(t)};n.Env.prototype.disconnect=function(){this.output.disconnect()};n.Env.prototype.add=function(t){var i=new e(t),r=this.mathOps.length,u=this.output;return n.prototype._mathChain(this,i,r,u,e)};n.Env.prototype.mult=function(t){var i=new o(t),r=this.mathOps.length,u=this.output;return n.prototype._mathChain(this,i,r,u,o)};n.Env.prototype.scale=function(t,i,r,u){var f=new s(t,i,r,u),e=this.mathOps.length,o=this.output;return n.prototype._mathChain(this,f,e,o,s)};n.Env.prototype.dispose=function(){var t=r.soundArray.indexOf(this),n;r.soundArray.splice(t,1);this.disconnect();try{this.control.dispose();this.control=null}catch(i){console.warn(i,"already disposed p5.Env")}for(n=1;n<this.mathOps.length;n++)this.mathOps[n].dispose()}}(t,f,u,h,c,i);wt=function(){function r(){for(var n,t=i.audiocontext,u=t.createBuffer(1,2048,t.sampleRate),f=u.getChannelData(0),r=0;r<2048;r++)f[r]=1;return n=t.createBufferSource(),n.buffer=u,n.loop=!0,n}var i=t;n.Pulse=function(t,u){n.Oscillator.call(this,t,"sawtooth");this.w=u||0;this.osc2=new n.SawOsc(t);this.dNode=i.audiocontext.createDelay();this.dcOffset=r();this.dcGain=i.audiocontext.createGain();this.dcOffset.connect(this.dcGain);this.dcGain.connect(this.output);this.f=t||440;var f=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=f;this.dcGain.gain.value=1.7*(.5-this.w);this.osc2.disconnect();this.osc2.panner.disconnect();this.osc2.amp(-1);this.osc2.output.connect(this.dNode);this.dNode.connect(this.output);this.output.gain.value=1;this.output.connect(this.panner)};n.Pulse.prototype=Object.create(n.Oscillator.prototype);n.Pulse.prototype.width=function(t){var r,i;typeof t=="number"?(t<=1&&t>=0&&(this.w=t,r=this.w/this.oscillator.frequency.value,this.dNode.delayTime.value=r),this.dcGain.gain.value=1.7*(.5-this.w)):(t.connect(this.dNode.delayTime),i=new n.SignalAdd(-.5),i.setInput(t),i=i.mult(-1),i=i.mult(1.7),i.connect(this.dcGain.gain))};n.Pulse.prototype.start=function(n,t){var u=i.audiocontext.currentTime,f=t||0,e,o;this.started||(e=n||this.f,o=this.oscillator.type,this.oscillator=i.audiocontext.createOscillator(),this.oscillator.frequency.setValueAtTime(e,u),this.oscillator.type=o,this.oscillator.connect(this.output),this.oscillator.start(f+u),this.osc2.oscillator=i.audiocontext.createOscillator(),this.osc2.oscillator.frequency.setValueAtTime(e,f+u),this.osc2.oscillator.type=o,this.osc2.oscillator.connect(this.osc2.output),this.osc2.start(f+u),this.freqNode=[this.oscillator.frequency,this.osc2.oscillator.frequency],this.dcOffset=r(),this.dcOffset.connect(this.dcGain),this.dcOffset.start(f+u),this.mods!==undefined&&this.mods.frequency!==undefined&&(this.mods.frequency.connect(this.freqNode[0]),this.mods.frequency.connect(this.freqNode[1])),this.started=!0,this.osc2.started=!0)};n.Pulse.prototype.stop=function(n){if(this.started){var t=n||0,r=i.audiocontext.currentTime;this.oscillator.stop(t+r);this.osc2.oscillator.stop(t+r);this.dcOffset.stop(t+r);this.started=!1;this.osc2.started=!1}};n.Pulse.prototype.freq=function(n,t,r){if(typeof n=="number"){this.f=n;var u=i.audiocontext.currentTime,t=t||0,r=r||0,f=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(u);this.oscillator.frequency.setValueAtTime(f,u+r);this.oscillator.frequency.exponentialRampToValueAtTime(n,r+t+u);this.osc2.oscillator.frequency.cancelScheduledValues(u);this.osc2.oscillator.frequency.setValueAtTime(f,u+r);this.osc2.oscillator.frequency.exponentialRampToValueAtTime(n,r+t+u);this.freqMod&&(this.freqMod.output.disconnect(),this.freqMod=null)}else n.output&&(n.output.disconnect(),n.output.connect(this.oscillator.frequency),n.output.connect(this.osc2.oscillator.frequency),this.freqMod=n)}}(t,b);bt=function(){var i=t;n.Noise=function(t){var i;n.Oscillator.call(this);delete this.f;delete this.freq;delete this.oscillator;i=t==="brown"?f:t==="pink"?u:r;this.buffer=i};n.Noise.prototype=Object.create(n.Oscillator.prototype);var r=function(){for(var r=2*i.audiocontext.sampleRate,n=i.audiocontext.createBuffer(1,r,i.audiocontext.sampleRate),u=n.getChannelData(0),t=0;t<r;t++)u[t]=Math.random()*2-1;return n.type="white",n}(),u=function(){for(var l=2*i.audiocontext.sampleRate,h=i.audiocontext.createBuffer(1,l,i.audiocontext.sampleRate),a=h.getChannelData(0),u,f,e,o,s,c,n,r=u=f=e=o=s=c=0,t=0;t<l;t++)n=Math.random()*2-1,r=.99886*r+n*.0555179,u=.99332*u+n*.0750759,f=.969*f+n*.153852,e=.8665*e+n*.3104856,o=.55*o+n*.5329522,s=-.7616*s-n*.016898,a[t]=r+u+f+e+o+s+c+n*.5362,a[t]*=.11,c=n*.115926;return h.type="pink",h}(),f=function(){for(var e,u=2*i.audiocontext.sampleRate,t=i.audiocontext.createBuffer(1,u,i.audiocontext.sampleRate),r=t.getChannelData(0),f=0,n=0;n<u;n++)e=Math.random()*2-1,r[n]=(f+.02*e)/1.02,f=r[n],r[n]*=3.5;return t.type="brown",t}();n.Noise.prototype.setType=function(n){switch(n){case"white":this.buffer=r;break;case"pink":this.buffer=u;break;case"brown":this.buffer=f;break;default:this.buffer=r}if(this.started){var t=i.audiocontext.currentTime;this.stop(t);this.start(t+.01)}};n.Noise.prototype.getType=function(){return this.buffer.type};n.Noise.prototype.start=function(){this.started&&this.stop();this.noise=i.audiocontext.createBufferSource();this.noise.buffer=this.buffer;this.noise.loop=!0;this.noise.connect(this.output);var n=i.audiocontext.currentTime;this.noise.start(n);this.started=!0};n.Noise.prototype.stop=function(){var n=i.audiocontext.currentTime;this.noise&&(this.noise.stop(n),this.started=!1)};n.Noise.prototype.dispose=function(){var n=i.audiocontext.currentTime,t=i.soundArray.indexOf(this);i.soundArray.splice(t,1);this.noise&&(this.noise.disconnect(),this.stop(n));this.output&&this.output.disconnect();this.panner&&this.panner.disconnect();this.output=null;this.panner=null;this.buffer=null;this.noise=null}}(t);kt=function(){var i=t;i.inputSources=[];n.AudioIn=function(t){this.input=i.audiocontext.createGain();this.output=i.audiocontext.createGain();this.stream=null;this.mediaStream=null;this.currentSource=null;this.enabled=!1;this.amplitude=new n.Amplitude;this.output.connect(this.amplitude.input);window.MediaStreamTrack&&window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia||(t?t():window.alert("This browser does not support MediaStreamTrack and mediaDevices"));i.soundArray.push(this)};n.AudioIn.prototype.start=function(n,t){var r=this,f,u;this.stream&&this.stop();f=i.inputSources[r.currentSource];u={audio:{sampleRate:i.audiocontext.sampleRate,echoCancellation:!1}};i.inputSources[this.currentSource]&&(u.audio.deviceId=f.deviceId);window.navigator.mediaDevices.getUserMedia(u).then(function(t){r.stream=t;r.enabled=!0;r.mediaStream=i.audiocontext.createMediaStreamSource(t);r.mediaStream.connect(r.output);r.amplitude.setInput(r.output);n&&n()}).catch(function(n){t?t(n):console.error(n)})};n.AudioIn.prototype.stop=function(){this.stream&&(this.stream.getTracks().forEach(function(n){n.stop()}),this.mediaStream.disconnect(),delete this.mediaStream,delete this.stream)};n.AudioIn.prototype.connect=function(n){n?n.hasOwnProperty("input")?this.output.connect(n.input):n.hasOwnProperty("analyser")?this.output.connect(n.analyser):this.output.connect(n):this.output.connect(i.input)};n.AudioIn.prototype.disconnect=function(){this.output.disconnect();this.output.connect(this.amplitude.input)};n.AudioIn.prototype.getLevel=function(n){return n&&(this.amplitude.smoothing=n),this.amplitude.getLevel()};n.AudioIn.prototype.amp=function(n,t){if(t){var r=t||0,u=this.output.gain.value;this.output.gain.cancelScheduledValues(i.audiocontext.currentTime);this.output.gain.setValueAtTime(u,i.audiocontext.currentTime);this.output.gain.linearRampToValueAtTime(n,r+i.audiocontext.currentTime)}else this.output.gain.cancelScheduledValues(i.audiocontext.currentTime),this.output.gain.setValueAtTime(n,i.audiocontext.currentTime)};n.AudioIn.prototype.getSources=function(n,t){return new Promise(function(r,u){window.navigator.mediaDevices.enumerateDevices().then(function(t){i.inputSources=t.filter(function(n){return n.kind==="audioinput"});r(i.inputSources);n&&n(i.inputSources)}).catch(function(n){u(n);t?t(n):console.error("This browser does not support MediaStreamTrack.getSources()")})})};n.AudioIn.prototype.setSource=function(n){i.inputSources.length>0&&n<i.inputSources.length?(this.currentSource=n,console.log("set source to ",i.inputSources[this.currentSource])):console.log("unable to set input source");this.stream&&this.stream.active&&this.start()};n.AudioIn.prototype.dispose=function(){var n=i.soundArray.indexOf(this);i.soundArray.splice(n,1);this.stop();this.output&&this.output.disconnect();this.amplitude&&this.amplitude.disconnect();delete this.amplitude;delete this.output}}(t);k=function(n){"use strict";return n.Negate=function(){this._multiply=this.input=this.output=new n.Multiply(-1)},n.extend(n.Negate,n.SignalBase),n.Negate.prototype.dispose=function(){return n.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},n.Negate}(i,u);d=function(n){"use strict";return n.Subtract=function(t){this.createInsOuts(2,0);this._sum=this.input[0]=this.output=new n.Gain;this._neg=new n.Negate;this._param=this.input[1]=new n.Signal(t);this._param.chain(this._neg,this._sum)},n.extend(n.Subtract,n.Signal),n.Subtract.prototype.dispose=function(){return n.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,this},n.Subtract}(i,f,k,e);g=function(n){"use strict";return n.GreaterThanZero=function(){this._thresh=this.output=new n.WaveShaper(function(n){return n<=0?0:1},127);this._scale=this.input=new n.Multiply(1e4);this._scale.connect(this._thresh)},n.extend(n.GreaterThanZero,n.SignalBase),n.GreaterThanZero.prototype.dispose=function(){return n.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},n.GreaterThanZero}(i,e,u);dt=function(n){"use strict";return n.GreaterThan=function(t){this.createInsOuts(2,0);this._param=this.input[0]=new n.Subtract(t);this.input[1]=this._param.input[1];this._gtz=this.output=new n.GreaterThanZero;this._param.connect(this._gtz)},n.extend(n.GreaterThan,n.Signal),n.GreaterThan.prototype.dispose=function(){return n.prototype.dispose.call(this),this._param.dispose(),this._param=null,this._gtz.dispose(),this._gtz=null,this},n.GreaterThan}(i,g,d);gt=function(n){"use strict";return n.Abs=function(){this._abs=this.input=this.output=new n.WaveShaper(function(n){return n===0?0:Math.abs(n)},127)},n.extend(n.Abs,n.SignalBase),n.Abs.prototype.dispose=function(){return n.prototype.dispose.call(this),this._abs.dispose(),this._abs=null,this},n.Abs}(i,a);ni=function(n){"use strict";return n.Modulo=function(t){this.createInsOuts(1,0);this._shaper=new n.WaveShaper(Math.pow(2,16));this._multiply=new n.Multiply;this._subtract=this.output=new n.Subtract;this._modSignal=new n.Signal(t);this.input.fan(this._shaper,this._subtract);this._modSignal.connect(this._multiply,0,0);this._shaper.connect(this._multiply,0,1);this._multiply.connect(this._subtract,0,1);this._setWaveShaper(t)},n.extend(n.Modulo,n.SignalBase),n.Modulo.prototype._setWaveShaper=function(n){this._shaper.setMap(function(t){return Math.floor((t+.0001)/n)})},Object.defineProperty(n.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(n){this._modSignal.value=n;this._setWaveShaper(n)}}),n.Modulo.prototype.dispose=function(){return n.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},n.Modulo}(i,a,u);ti=function(n){"use strict";return n.Pow=function(t){this._exp=this.defaultArg(t,1);this._expScaler=this.input=this.output=new n.WaveShaper(this._expFunc(this._exp),8192)},n.extend(n.Pow,n.SignalBase),Object.defineProperty(n.Pow.prototype,"value",{get:function(){return this._exp},set:function(n){this._exp=n;this._expScaler.setMap(this._expFunc(this._exp))}}),n.Pow.prototype._expFunc=function(n){return function(t){return Math.pow(Math.abs(t),n)}},n.Pow.prototype.dispose=function(){return n.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},n.Pow}(i);tr=function(n){"use strict";return n.AudioToGain=function(){this._norm=this.input=this.output=new n.WaveShaper(function(n){return(n+1)/2})},n.extend(n.AudioToGain,n.SignalBase),n.AudioToGain.prototype.dispose=function(){return n.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},n.AudioToGain}(i,a);ii=function(n){"use strict";function i(n,t,i){var r=new n;return i._eval(t[0]).connect(r,0,0),i._eval(t[1]).connect(r,0,1),r}function t(n,t,i){var r=new n;return i._eval(t[0]).connect(r,0,0),r}function r(n){return n?parseFloat(n):undefined}function u(n){return n&&n.args?parseFloat(n.args):undefined}return n.Expr=function(){var t=this._replacements(Array.prototype.slice.call(arguments)),i=this._parseInputs(t),n,r,u;for(this._nodes=[],this.input=new Array(i),n=0;n<i;n++)this.input[n]=this.context.createGain();r=this._parseTree(t);try{u=this._eval(r)}catch(f){this._disposeNodes();throw new Error("Tone.Expr: Could evaluate expression: "+t);}this.output=u},n.extend(n.Expr,n.SignalBase),n.Expr._Expressions={value:{signal:{regexp:/^\d+\.\d+|^\d+/,method:function(t){return new n.Signal(r(t))}},input:{regexp:/^\$\d/,method:function(n,t){return t.input[r(n.substr(1))]}}},glue:{"(":{regexp:/^\(/},")":{regexp:/^\)/},",":{regexp:/^,/}},func:{abs:{regexp:/^abs/,method:t.bind(this,n.Abs)},mod:{regexp:/^mod/,method:function(t,i){var f=u(t[1]),r=new n.Modulo(f);return i._eval(t[0]).connect(r),r}},pow:{regexp:/^pow/,method:function(t,i){var f=u(t[1]),r=new n.Pow(f);return i._eval(t[0]).connect(r),r}},a2g:{regexp:/^a2g/,method:function(t,i){var r=new n.AudioToGain;return i._eval(t[0]).connect(r),r}}},binary:{"+":{regexp:/^\+/,precedence:1,method:i.bind(this,n.Add)},"-":{regexp:/^\-/,precedence:1,method:function(r,u){return r.length===1?t(n.Negate,r,u):i(n.Subtract,r,u)}},"*":{regexp:/^\*/,precedence:0,method:i.bind(this,n.Multiply)}},unary:{"-":{regexp:/^\-/,method:t.bind(this,n.Negate)},"!":{regexp:/^\!/,method:t.bind(this,n.NOT)}}},n.Expr.prototype._parseInputs=function(n){var i=n.match(/\$\d/g),r=0,t,u;if(i!==null)for(t=0;t<i.length;t++)u=parseInt(i[t].substr(1))+1,r=Math.max(r,u);return r},n.Expr.prototype._replacements=function(n){for(var t=n.shift(),i=0;i<n.length;i++)t=t.replace(/\%/i,n[i]);return t},n.Expr.prototype._tokenize=function(t){function f(t){var i,r,u;for(i in n.Expr._Expressions){r=n.Expr._Expressions[i];for(u in r){var f=r[u],o=f.regexp,e=t.match(o);if(e!==null)return{type:i,value:e[0],method:f.method}}}throw new SyntaxError("Tone.Expr: Unexpected token "+t);}for(var u=-1,i=[],r;t.length>0;)t=t.trim(),r=f(t),i.push(r),t=t.substr(r.value.length);return{next:function(){return i[++u]},peek:function(){return i[u+1]}}},n.Expr.prototype._parseTree=function(t){function u(n,t){return!r(n)&&n.type==="glue"&&n.value===t}function e(t,i,u){var e=n.Expr._Expressions[i],o,f;if(!r(t))for(o in e)if(f=e[o],f.regexp.test(t.value)&&(r(u)||f.precedence===u))return!0;return!1}function f(n){var u,t;for(r(n)&&(n=5),u=n<0?o():f(n-1),t=i.peek();e(t,"binary",n);)t=i.next(),u={operator:t.value,method:t.method,args:[u,f(n-1)]},t=i.peek();return u}function o(){var n,t;return(n=i.peek(),e(n,"unary"))?(n=i.next(),t=o(),{operator:n.value,method:n.method,args:[t]}):s()}function s(){var n,t;if(n=i.peek(),r(n))throw new SyntaxError("Tone.Expr: Unexpected termination of expression");if(n.type==="func")return n=i.next(),h(n);if(n.type==="value")return n=i.next(),{method:n.method,args:n.value};if(u(n,"(")){if(i.next(),t=f(),n=i.next(),!u(n,")"))throw new SyntaxError("Expected )");return t}throw new SyntaxError("Tone.Expr: Parse error, cannot process token "+n.value);}function h(n){var t,r=[];if(t=i.next(),!u(t,"("))throw new SyntaxError('Tone.Expr: Expected ( in a function call "'+n.value+'"');if(t=i.peek(),u(t,")")||(r=c()),t=i.next(),!u(t,")"))throw new SyntaxError('Tone.Expr: Expected ) in a function call "'+n.value+'"');return{method:n.method,args:r,name:name}}function c(){for(var t,n,e=[];;){if(n=f(),r(n))break;if(e.push(n),t=i.peek(),!u(t,","))break;i.next()}return e}var i=this._tokenize(t),r=this.isUndef.bind(this);return f()},n.Expr.prototype._eval=function(n){if(!this.isUndef(n)){var t=n.method(n.args,this);return this._nodes.push(t),t}},n.Expr.prototype._disposeNodes=function(){for(var n,t=0;t<this._nodes.length;t++)n=this._nodes[t],this.isFunction(n.dispose)?n.dispose():this.isFunction(n.disconnect)&&n.disconnect(),n=null,this._nodes[t]=null;this._nodes=null},n.Expr.prototype.dispose=function(){n.prototype.dispose.call(this);this._disposeNodes()},n.Expr}(i,f,d,u,dt,g,gt,k,ni,ti);ri=function(n){"use strict";return n.EqualPowerGain=function(){this._eqPower=this.input=this.output=new n.WaveShaper(function(n){return Math.abs(n)<.001?0:this.equalPowerScale(n)}.bind(this),4096)},n.extend(n.EqualPowerGain,n.SignalBase),n.EqualPowerGain.prototype.dispose=function(){return n.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},n.EqualPowerGain}(i);nt=function(n){"use strict";return n.CrossFade=function(t){this.createInsOuts(2,1);this.a=this.input[0]=new n.Gain;this.b=this.input[1]=new n.Gain;this.fade=new n.Signal(this.defaultArg(t,.5),n.Type.NormalRange);this._equalPowerA=new n.EqualPowerGain;this._equalPowerB=new n.EqualPowerGain;this._invert=new n.Expr("1 - $0");this.a.connect(this.output);this.b.connect(this.output);this.fade.chain(this._equalPowerB,this.b.gain);this.fade.chain(this._invert,this._equalPowerA,this.a.gain);this._readOnly("fade")},n.extend(n.CrossFade),n.CrossFade.prototype.dispose=function(){return n.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this.a.dispose(),this.a=null,this.b.dispose(),this.b=null,this},n.CrossFade}(i,e,ii,ri);r=function(){var i=t,r=nt;return n.Effect=function(){this.ac=i.audiocontext;this.input=this.ac.createGain();this.output=this.ac.createGain();this._drywet=new r(1);this.wet=this.ac.createGain();this.input.connect(this._drywet.a);this.wet.connect(this._drywet.b);this._drywet.connect(this.output);this.connect();i.soundArray.push(this)},n.Effect.prototype.amp=function(n,t,r){var t=t||0,r=r||0,u=i.audiocontext.currentTime,f=this.output.gain.value;this.output.gain.cancelScheduledValues(u);this.output.gain.linearRampToValueAtTime(f,u+r+.001);this.output.gain.linearRampToValueAtTime(n,u+r+t+.001)},n.Effect.prototype.chain=function(){if(arguments.length>0){this.connect(arguments[0]);for(var n=1;n<arguments.length;n+=1)arguments[n-1].connect(arguments[n])}return this},n.Effect.prototype.drywet=function(n){return typeof n!="undefined"&&(this._drywet.fade.value=n),this._drywet.fade.value},n.Effect.prototype.connect=function(t){var i=t||n.soundOut.input;this.output.connect(i.input?i.input:i)},n.Effect.prototype.disconnect=function(){this.output.disconnect()},n.Effect.prototype.dispose=function(){var n=i.soundArray.indexOf(this);i.soundArray.splice(n,1);this.input.disconnect();this.input=undefined;this.output.disconnect();this.output=undefined;this._drywet.disconnect();delete this._drywet;this.wet.disconnect();delete this.wet;this.ac=undefined},n.Effect}(t,nt);l=function(){var u=t,i=r;return n.Filter=function(n){i.call(this);this.biquad=this.ac.createBiquadFilter();this.input.connect(this.biquad);this.biquad.connect(this.wet);n&&this.setType(n);this._on=!0;this._untoggledType=this.biquad.type},n.Filter.prototype=Object.create(i.prototype),n.Filter.prototype.process=function(n,t,i,r){n.connect(this.input);this.set(t,i,r)},n.Filter.prototype.set=function(n,t,i){n&&this.freq(n,i);t&&this.res(t,i)},n.Filter.prototype.freq=function(n,t){var i=t||0;return n<=0&&(n=1),typeof n=="number"?(this.biquad.frequency.value=n,this.biquad.frequency.cancelScheduledValues(this.ac.currentTime+.01+i),this.biquad.frequency.exponentialRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.biquad.frequency),this.biquad.frequency.value},n.Filter.prototype.res=function(n,t){var i=t||0;return typeof n=="number"?(this.biquad.Q.value=n,this.biquad.Q.cancelScheduledValues(this.ac.currentTime+.01+i),this.biquad.Q.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.biquad.Q),this.biquad.Q.value},n.Filter.prototype.gain=function(n,t){var i=t||0;return typeof n=="number"?(this.biquad.gain.value=n,this.biquad.gain.cancelScheduledValues(this.ac.currentTime+.01+i),this.biquad.gain.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.biquad.gain),this.biquad.gain.value},n.Filter.prototype.toggle=function(){return this._on=!this._on,this._on===!0?this.biquad.type=this._untoggledType:this._on===!1&&(this.biquad.type="allpass"),this._on},n.Filter.prototype.setType=function(n){this.biquad.type=n;this._untoggledType=this.biquad.type},n.Filter.prototype.dispose=function(){i.prototype.dispose.apply(this);this.biquad.disconnect();this.biquad=undefined},n.LowPass=function(){n.Filter.call(this,"lowpass")},n.LowPass.prototype=Object.create(n.Filter.prototype),n.HighPass=function(){n.Filter.call(this,"highpass")},n.HighPass.prototype=Object.create(n.Filter.prototype),n.BandPass=function(){n.Filter.call(this,"bandpass")},n.BandPass.prototype=Object.create(n.Filter.prototype),n.Filter}(t,r);tt=function(){var r=l,u=t,i=function(n,t){r.call(this,"peaking");this.disconnect();this.set(n,t);this.biquad.gain.value=0;delete this.input;delete this.output;delete this._drywet;delete this.wet};return i.prototype=Object.create(r.prototype),i.prototype.amp=function(){console.warn("`amp()` is not available for p5.EQ bands. Use `.gain()`")},i.prototype.drywet=function(){console.warn("`drywet()` is not available for p5.EQ bands.")},i.prototype.connect=function(t){var i=t||n.soundOut.input;this.biquad?this.biquad.connect(i.input?i.input:i):this.output.connect(i.input?i.input:i)},i.prototype.disconnect=function(){this.biquad.disconnect()},i.prototype.dispose=function(){var n=u.soundArray.indexOf(this);u.soundArray.splice(n,1);this.disconnect();delete this.biquad},i}(l,t);ui=function(){var t=r,i=tt;return n.EQ=function(n){var f,r,u,i;for(t.call(this),n=n===3||n===8?n:3,f=n===3?Math.pow(2,3):2,this.bands=[],i=0;i<n;i++)i===n-1?(r=21e3,u=.01):i===0?(r=100,u=.1):i===1?(r=n===3?360*f:360,u=1):(r=this.bands[i-1].freq()*f,u=1),this.bands[i]=this._newBand(r,u),i>0?this.bands[i-1].connect(this.bands[i].biquad):this.input.connect(this.bands[i].biquad);this.bands[n-1].connect(this.output)},n.EQ.prototype=Object.create(t.prototype),n.EQ.prototype.process=function(n){n.connect(this.input)},n.EQ.prototype.set=function(){if(arguments.length===this.bands.length*2)for(var n=0;n<arguments.length;n+=2)this.bands[n/2].freq(arguments[n]),this.bands[n/2].gain(arguments[n+1]);else console.error("Argument mismatch. .set() should be called with "+this.bands.length*2+" arguments. (one frequency and gain value pair for each band of the eq)")},n.EQ.prototype._newBand=function(n,t){return new i(n,t)},n.EQ.prototype.dispose=function(){for(t.prototype.dispose.apply(this);this.bands.length>0;)delete this.bands.pop().dispose();delete this.bands},n.EQ}(r,tt);fi=function(){var u=t,i=r;return n.Panner3D=function(){i.call(this);this.panner=this.ac.createPanner();this.panner.panningModel="HRTF";this.panner.distanceModel="linear";this.panner.connect(this.output);this.input.connect(this.panner)},n.Panner3D.prototype=Object.create(i.prototype),n.Panner3D.prototype.process=function(n){n.connect(this.input)},n.Panner3D.prototype.set=function(n,t,i,r){return this.positionX(n,r),this.positionY(t,r),this.positionZ(i,r),[this.panner.positionX.value,this.panner.positionY.value,this.panner.positionZ.value]},n.Panner3D.prototype.positionX=function(n,t){var i=t||0;return typeof n=="number"?(this.panner.positionX.value=n,this.panner.positionX.cancelScheduledValues(this.ac.currentTime+.01+i),this.panner.positionX.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.panner.positionX),this.panner.positionX.value},n.Panner3D.prototype.positionY=function(n,t){var i=t||0;return typeof n=="number"?(this.panner.positionY.value=n,this.panner.positionY.cancelScheduledValues(this.ac.currentTime+.01+i),this.panner.positionY.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.panner.positionY),this.panner.positionY.value},n.Panner3D.prototype.positionZ=function(n,t){var i=t||0;return typeof n=="number"?(this.panner.positionZ.value=n,this.panner.positionZ.cancelScheduledValues(this.ac.currentTime+.01+i),this.panner.positionZ.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.panner.positionZ),this.panner.positionZ.value},n.Panner3D.prototype.orient=function(n,t,i,r){return this.orientX(n,r),this.orientY(t,r),this.orientZ(i,r),[this.panner.orientationX.value,this.panner.orientationY.value,this.panner.orientationZ.value]},n.Panner3D.prototype.orientX=function(n,t){var i=t||0;return typeof n=="number"?(this.panner.orientationX.value=n,this.panner.orientationX.cancelScheduledValues(this.ac.currentTime+.01+i),this.panner.orientationX.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.panner.orientationX),this.panner.orientationX.value},n.Panner3D.prototype.orientY=function(n,t){var i=t||0;return typeof n=="number"?(this.panner.orientationY.value=n,this.panner.orientationY.cancelScheduledValues(this.ac.currentTime+.01+i),this.panner.orientationY.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.panner.orientationY),this.panner.orientationY.value},n.Panner3D.prototype.orientZ=function(n,t){var i=t||0;return typeof n=="number"?(this.panner.orientationZ.value=n,this.panner.orientationZ.cancelScheduledValues(this.ac.currentTime+.01+i),this.panner.orientationZ.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.panner.orientationZ),this.panner.orientationZ.value},n.Panner3D.prototype.setFalloff=function(n,t){this.maxDist(n);this.rolloff(t)},n.Panner3D.prototype.maxDist=function(n){return typeof n=="number"&&(this.panner.maxDistance=n),this.panner.maxDistance},n.Panner3D.prototype.rolloff=function(n){return typeof n=="number"&&(this.panner.rolloffFactor=n),this.panner.rolloffFactor},n.Panner3D.dispose=function(){i.prototype.dispose.apply(this);this.panner.disconnect();delete this.panner},n.Panner3D}(t,r);ei=function(){var i=t,u=r;return n.Listener3D=function(){this.ac=i.audiocontext;this.listener=this.ac.listener},n.Listener3D.prototype.process=function(n){n.connect(this.input)},n.Listener3D.prototype.position=function(n,t,i,r){return this.positionX(n,r),this.positionY(t,r),this.positionZ(i,r),[this.listener.positionX.value,this.listener.positionY.value,this.listener.positionZ.value]},n.Listener3D.prototype.positionX=function(n,t){var i=t||0;return typeof n=="number"?(this.listener.positionX.value=n,this.listener.positionX.cancelScheduledValues(this.ac.currentTime+.01+i),this.listener.positionX.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.listener.positionX),this.listener.positionX.value},n.Listener3D.prototype.positionY=function(n,t){var i=t||0;return typeof n=="number"?(this.listener.positionY.value=n,this.listener.positionY.cancelScheduledValues(this.ac.currentTime+.01+i),this.listener.positionY.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.listener.positionY),this.listener.positionY.value},n.Listener3D.prototype.positionZ=function(n,t){var i=t||0;return typeof n=="number"?(this.listener.positionZ.value=n,this.listener.positionZ.cancelScheduledValues(this.ac.currentTime+.01+i),this.listener.positionZ.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.listener.positionZ),this.listener.positionZ.value},n.Listener3D.prototype.orient=function(n,t,i,r,u,f,e){return arguments.length===3||arguments.length===4?(e=arguments[3],this.orientForward(n,t,i,e)):(arguments.length===6||arguments===7)&&(this.orientForward(n,t,i),this.orientUp(r,u,f,e)),[this.listener.forwardX.value,this.listener.forwardY.value,this.listener.forwardZ.value,this.listener.upX.value,this.listener.upY.value,this.listener.upZ.value]},n.Listener3D.prototype.orientForward=function(n,t,i,r){return this.forwardX(n,r),this.forwardY(t,r),this.forwardZ(i,r),[this.listener.forwardX,this.listener.forwardY,this.listener.forwardZ]},n.Listener3D.prototype.orientUp=function(n,t,i,r){return this.upX(n,r),this.upY(t,r),this.upZ(i,r),[this.listener.upX,this.listener.upY,this.listener.upZ]},n.Listener3D.prototype.forwardX=function(n,t){var i=t||0;return typeof n=="number"?(this.listener.forwardX.value=n,this.listener.forwardX.cancelScheduledValues(this.ac.currentTime+.01+i),this.listener.forwardX.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.listener.forwardX),this.listener.forwardX.value},n.Listener3D.prototype.forwardY=function(n,t){var i=t||0;return typeof n=="number"?(this.listener.forwardY.value=n,this.listener.forwardY.cancelScheduledValues(this.ac.currentTime+.01+i),this.listener.forwardY.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.listener.forwardY),this.listener.forwardY.value},n.Listener3D.prototype.forwardZ=function(n,t){var i=t||0;return typeof n=="number"?(this.listener.forwardZ.value=n,this.listener.forwardZ.cancelScheduledValues(this.ac.currentTime+.01+i),this.listener.forwardZ.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.listener.forwardZ),this.listener.forwardZ.value},n.Listener3D.prototype.upX=function(n,t){var i=t||0;return typeof n=="number"?(this.listener.upX.value=n,this.listener.upX.cancelScheduledValues(this.ac.currentTime+.01+i),this.listener.upX.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.listener.upX),this.listener.upX.value},n.Listener3D.prototype.upY=function(n,t){var i=t||0;return typeof n=="number"?(this.listener.upY.value=n,this.listener.upY.cancelScheduledValues(this.ac.currentTime+.01+i),this.listener.upY.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.listener.upY),this.listener.upY.value},n.Listener3D.prototype.upZ=function(n,t){var i=t||0;return typeof n=="number"?(this.listener.upZ.value=n,this.listener.upZ.cancelScheduledValues(this.ac.currentTime+.01+i),this.listener.upZ.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):n&&n.connect(this.listener.upZ),this.listener.upZ.value},n.Listener3D}(t,r);oi=function(){var i=l,t=r;n.Delay=function(){t.call(this);this._split=this.ac.createChannelSplitter(2);this._merge=this.ac.createChannelMerger(2);this._leftGain=this.ac.createGain();this._rightGain=this.ac.createGain();this.leftDelay=this.ac.createDelay();this.rightDelay=this.ac.createDelay();this._leftFilter=new i;this._rightFilter=new i;this._leftFilter.disconnect();this._rightFilter.disconnect();this._leftFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime);this._rightFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime);this._leftFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime);this._rightFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime);this.input.connect(this._split);this.leftDelay.connect(this._leftGain);this.rightDelay.connect(this._rightGain);this._leftGain.connect(this._leftFilter.input);this._rightGain.connect(this._rightFilter.input);this._merge.connect(this.wet);this._leftFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime);this._rightFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime);this.setType(0);this._maxDelay=this.leftDelay.delayTime.maxValue;this.feedback(.5)};n.Delay.prototype=Object.create(t.prototype);n.Delay.prototype.process=function(n,t,i,r){var u=i||0,f=t||0;if(u>=1)throw new Error("Feedback value will force a positive feedback loop.");if(f>=this._maxDelay)throw new Error("Delay Time exceeds maximum delay time of "+this._maxDelay+" second.");n.connect(this.input);this.leftDelay.delayTime.setValueAtTime(f,this.ac.currentTime);this.rightDelay.delayTime.setValueAtTime(f,this.ac.currentTime);this._leftGain.gain.value=u;this._rightGain.gain.value=u;r&&(this._leftFilter.freq(r),this._rightFilter.freq(r))};n.Delay.prototype.delayTime=function(n){typeof n!="number"?(n.connect(this.leftDelay.delayTime),n.connect(this.rightDelay.delayTime)):(this.leftDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.rightDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.leftDelay.delayTime.linearRampToValueAtTime(n,this.ac.currentTime),this.rightDelay.delayTime.linearRampToValueAtTime(n,this.ac.currentTime))};n.Delay.prototype.feedback=function(n){if(n&&typeof n!="number")n.connect(this._leftGain.gain),n.connect(this._rightGain.gain);else if(n>=1)throw new Error("Feedback value will force a positive feedback loop.");else typeof n=="number"&&(this._leftGain.gain.value=n,this._rightGain.gain.value=n);return this._leftGain.gain.value};n.Delay.prototype.filter=function(n,t){this._leftFilter.set(n,t);this._rightFilter.set(n,t)};n.Delay.prototype.setType=function(n){n===1&&(n="pingPong");this._split.disconnect();this._leftFilter.disconnect();this._rightFilter.disconnect();this._split.connect(this.leftDelay,0);this._split.connect(this.rightDelay,1);switch(n){case"pingPong":this._rightFilter.setType(this._leftFilter.biquad.type);this._leftFilter.output.connect(this._merge,0,0);this._rightFilter.output.connect(this._merge,0,1);this._leftFilter.output.connect(this.rightDelay);this._rightFilter.output.connect(this.leftDelay);break;default:this._leftFilter.output.connect(this._merge,0,0);this._rightFilter.output.connect(this._merge,0,1);this._leftFilter.output.connect(this.leftDelay);this._rightFilter.output.connect(this.rightDelay)}};n.Delay.prototype.dispose=function(){t.prototype.dispose.apply(this);this._split.disconnect();this._leftFilter.dispose();this._rightFilter.dispose();this._merge.disconnect();this._leftGain.disconnect();this._rightGain.disconnect();this.leftDelay.disconnect();this.rightDelay.disconnect();this._split=undefined;this._leftFilter=undefined;this._rightFilter=undefined;this._merge=undefined;this._leftGain=undefined;this._rightGain=undefined;this.leftDelay=undefined;this.rightDelay=undefined}}(l,r);si=function(){var i=s,t=r;n.Reverb=function(){t.call(this);this.convolverNode=this.ac.createConvolver();this.input.gain.value=.5;this.input.connect(this.convolverNode);this.convolverNode.connect(this.wet);this._seconds=3;this._decay=2;this._reverse=!1;this._buildImpulse()};n.Reverb.prototype=Object.create(t.prototype);n.Reverb.prototype.process=function(n,t,i,r){n.connect(this.input);var u=!1;t&&(this._seconds=t,u=!0);i&&(this._decay=i);r&&(this._reverse=r);u&&this._buildImpulse()};n.Reverb.prototype.set=function(n,t,i){var r=!1;n&&(this._seconds=n,r=!0);t&&(this._decay=t);i&&(this._reverse=i);r&&this._buildImpulse()};n.Reverb.prototype._buildImpulse=function(){for(var u=this.ac.sampleRate,t=u*this._seconds,f=this._decay,i=this.ac.createBuffer(2,t,u),e=i.getChannelData(0),o=i.getChannelData(1),r,n=0;n<t;n++)r=this._reverse?t-n:n,e[n]=(Math.random()*2-1)*Math.pow(1-r/t,f),o[n]=(Math.random()*2-1)*Math.pow(1-r/t,f);this.convolverNode.buffer=i};n.Reverb.prototype.dispose=function(){t.prototype.dispose.apply(this);this.convolverNode&&(this.convolverNode.buffer=null,this.convolverNode=null)};n.Convolver=function(n,i,r){t.call(this);this.convolverNode=this.ac.createConvolver();this.input.gain.value=.5;this.input.connect(this.convolverNode);this.convolverNode.connect(this.wet);n?(this.impulses=[],this._loadBuffer(n,i,r)):(this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse())};n.Convolver.prototype=Object.create(n.Reverb.prototype);n.prototype.registerPreloadMethod("createConvolver",n.prototype);n.prototype.createConvolver=function(t,i,r){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var u=new n.Convolver(t,i,r);return u.impulses=[],u};n.Convolver.prototype._loadBuffer=function(t,r,u){var t=n.prototype._checkFileFormats(t),e=this,o=(new Error).stack,s=n.prototype.getAudioContext(),f=new XMLHttpRequest;f.open("GET",t,!0);f.responseType="arraybuffer";f.onload=function(){if(f.status===200)s.decodeAudioData(f.response,function(n){var i={},u=t.split("/");i.name=u[u.length-1];i.audioBuffer=n;e.impulses.push(i);e.convolverNode.buffer=i.audioBuffer;r&&r(i)},function(){var n=new i("decodeAudioData",o,e.url),t="AudioContext error at decodeAudioData for "+e.url;u?(n.msg=t,u(n)):console.error(t+"\n The error stack trace includes: \n"+n.stack)});else{var n=new i("loadConvolver",o,e.url),h="Unable to load "+e.url+". The request status was: "+f.status+" ("+f.statusText+")";u?(n.message=h,u(n)):console.error(h+"\n The error stack trace includes: \n"+n.stack)}};f.onerror=function(){var n=new i("loadConvolver",o,e.url),t="There was no response from the server at "+e.url+". Check the url and internet connectivity.";u?(n.message=t,u(n)):console.error(t+"\n The error stack trace includes: \n"+n.stack)};f.send()};n.Convolver.prototype.set=null;n.Convolver.prototype.process=function(n){n.connect(this.input)};n.Convolver.prototype.impulses=[];n.Convolver.prototype.addImpulse=function(n,t,i){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");this._loadBuffer(n,t,i)};n.Convolver.prototype.resetImpulse=function(n,t,i){window.location.origin.indexOf("file://")>-1&&window.cordova==="undefined"&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");this.impulses=[];this._loadBuffer(n,t,i)};n.Convolver.prototype.toggleImpulse=function(n){if(typeof n=="number"&&n<this.impulses.length&&(this.convolverNode.buffer=this.impulses[n].audioBuffer),typeof n=="string")for(var t=0;t<this.impulses.length;t++)if(this.impulses[t].name===n){this.convolverNode.buffer=this.impulses[t].audioBuffer;break}};n.Convolver.prototype.dispose=function(){t.prototype.dispose.apply(this);for(var n in this.impulses)this.impulses[n]&&(this.impulses[n]=null);this.convolverNode.disconnect();this.concolverNode=null}}(s,r,o);hi=function(n){"use strict";return n.TimelineState=function(t){n.Timeline.call(this);this._initial=t},n.extend(n.TimelineState,n.Timeline),n.TimelineState.prototype.getValueAtTime=function(n){var t=this.get(n);return t!==null?t.state:this._initial},n.TimelineState.prototype.setStateAtTime=function(n,t){this.add({state:n,time:t})},n.TimelineState}(i,yt);v=function(n){"use strict";return n.Clock=function(){n.Emitter.call(this);var t=this.optionsObject(arguments,["callback","frequency"],n.Clock.defaults);this.callback=t.callback;this._nextTick=0;this._lastState=n.State.Stopped;this.frequency=new n.TimelineSignal(t.frequency,n.Type.Frequency);this._readOnly("frequency");this.ticks=0;this._state=new n.TimelineState(n.State.Stopped);this._boundLoop=this._loop.bind(this);this.context.on("tick",this._boundLoop)},n.extend(n.Clock,n.Emitter),n.Clock.defaults={callback:n.noOp,frequency:1,lookAhead:"auto"},Object.defineProperty(n.Clock.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),n.Clock.prototype.start=function(t,i){return t=this.toSeconds(t),this._state.getValueAtTime(t)!==n.State.Started&&this._state.add({state:n.State.Started,time:t,offset:i}),this},n.Clock.prototype.stop=function(t){return t=this.toSeconds(t),this._state.cancel(t),this._state.setStateAtTime(n.State.Stopped,t),this},n.Clock.prototype.pause=function(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)===n.State.Started&&this._state.setStateAtTime(n.State.Paused,t),this},n.Clock.prototype._loop=function(){for(var u=this.now(),f=this.context.lookAhead,e=this.context.updateInterval,o=this.context.lag*2,s=u+f+e+o,t,i,r;s>this._nextTick&&this._state;)t=this._state.getValueAtTime(this._nextTick),t!==this._lastState&&(this._lastState=t,i=this._state.get(this._nextTick),t===n.State.Started?(this._nextTick=i.time,this.isUndef(i.offset)||(this.ticks=i.offset),this.emit("start",i.time,this.ticks)):t===n.State.Stopped?(this.ticks=0,this.emit("stop",i.time)):t===n.State.Paused&&this.emit("pause",i.time)),r=this._nextTick,this.frequency&&(this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick),t===n.State.Started&&(this.callback(r),this.ticks++))},n.Clock.prototype.getStateAtTime=function(n){return n=this.toSeconds(n),this._state.getValueAtTime(n)},n.Clock.prototype.dispose=function(){n.Emitter.prototype.dispose.call(this);this.context.off("tick",this._boundLoop);this._writable("frequency");this.frequency.dispose();this.frequency=null;this._boundLoop=null;this._nextTick=Infinity;this.callback=null;this._state.dispose();this._state=null},n.Clock}(i,c,hi,lt);ci=function(){var i=t,r=v;n.Metro=function(){this.clock=new r({callback:this.ontick.bind(this)});this.syncedParts=[];this.bpm=120;this._init();this.prevTick=0;this.tatumTime=0;this.tickCallback=function(){}};n.Metro.prototype.ontick=function(n){var u=n-this.prevTick,t=n-i.audiocontext.currentTime,r;u-this.tatumTime<=-.02||(this.prevTick=n,r=this,this.syncedParts.forEach(function(n){n.isPlaying&&(n.incrementStep(t),n.phrases.forEach(function(n){var i=n.sequence,u=r.metroTicks%i.length;i[u]!==0&&(r.metroTicks<i.length||!n.looping)&&n.callback(t,i[u])}))}),this.metroTicks+=1,this.tickCallback(t))};n.Metro.prototype.setBPM=function(n,t){var u=60/(n*this.tatums),r=i.audiocontext.currentTime,t;this.tatumTime=u;t=t||0;this.clock.frequency.setValueAtTime(this.clock.frequency.value,r);this.clock.frequency.linearRampToValueAtTime(n,r+t);this.bpm=n};n.Metro.prototype.getBPM=function(){return this.clock.getRate()/this.tatums*60};n.Metro.prototype._init=function(){this.metroTicks=0};n.Metro.prototype.resetSync=function(n){this.syncedParts=[n]};n.Metro.prototype.pushSync=function(n){this.syncedParts.push(n)};n.Metro.prototype.start=function(n){var t=n||0,r=i.audiocontext.currentTime;this.clock.start(r+t);this.setBPM(this.bpm)};n.Metro.prototype.stop=function(n){var t=n||0,r=i.audiocontext.currentTime;this.clock.stop(r+t)};n.Metro.prototype.beatLength=function(n){this.tatums=1/n/4}}(t,v);li=function(){function u(n){n.currentPart++;n.currentPart>=n.parts.length?(n.scoreStep=0,n.onended()):(n.scoreStep=0,n.parts[n.currentPart-1].stop(),n.parts[n.currentPart].start())}var i=t,r=120;n.prototype.setBPM=function(n,t){r=n;for(var u in i.parts)i.parts[u]&&i.parts[u].setBPM(n,t)};n.Phrase=function(n,t,i){this.phraseStep=0;this.name=n;this.callback=t;this.sequence=i};n.Part=function(t,u){this.length=t||0;this.partStep=0;this.phrases=[];this.isPlaying=!1;this.noLoop();this.tatums=u||.0625;this.metro=new n.Metro;this.metro._init();this.metro.beatLength(this.tatums);this.metro.setBPM(r);i.parts.push(this);this.callback=function(){}};n.Part.prototype.setBPM=function(n,t){this.metro.setBPM(n,t)};n.Part.prototype.getBPM=function(){return this.metro.getBPM()};n.Part.prototype.start=function(n){if(!this.isPlaying){this.isPlaying=!0;this.metro.resetSync(this);var t=n||0;this.metro.start(t)}};n.Part.prototype.loop=function(n){this.looping=!0;this.onended=function(){this.partStep=0};var t=n||0;this.start(t)};n.Part.prototype.noLoop=function(){this.looping=!1;this.onended=function(){this.stop()}};n.Part.prototype.stop=function(n){this.partStep=0;this.pause(n)};n.Part.prototype.pause=function(n){this.isPlaying=!1;var t=n||0;this.metro.stop(t)};n.Part.prototype.addPhrase=function(t,i,r){var u;if(arguments.length===3)u=new n.Phrase(t,i,r);else if(arguments[0]instanceof n.Phrase)u=arguments[0];else throw"invalid input. addPhrase accepts name, callback, array or a p5.Phrase";this.phrases.push(u);u.sequence.length>this.length&&(this.length=u.sequence.length)};n.Part.prototype.removePhrase=function(n){for(var t in this.phrases)this.phrases[t].name===n&&this.phrases.splice(t,1)};n.Part.prototype.getPhrase=function(n){for(var t in this.phrases)if(this.phrases[t].name===n)return this.phrases[t]};n.Part.prototype.replaceSequence=function(n,t){for(var i in this.phrases)this.phrases[i].name===n&&(this.phrases[i].sequence=t)};n.Part.prototype.incrementStep=function(n){this.partStep<this.length-1?(this.callback(n),this.partStep+=1):this.looping||this.partStep!==this.length-1||(console.log("done"),this.onended())};n.Part.prototype.onStep=function(n){this.callback=n};n.Score=function(){var t,n;this.parts=[];this.currentPart=0;t=this;for(n in arguments)arguments[n]&&this.parts[n]&&(this.parts[n]=arguments[n],this.parts[n].nextPart=this.parts[n+1],this.parts[n].onended=function(){t.resetPart(n);u(t)});this.looping=!1};n.Score.prototype.onended=function(){this.looping?this.parts[0].start():this.parts[this.parts.length-1].onended=function(){this.stop();this.resetParts()};this.currentPart=0};n.Score.prototype.start=function(){this.parts[this.currentPart].start();this.scoreStep=0};n.Score.prototype.stop=function(){this.parts[this.currentPart].stop();this.currentPart=0;this.scoreStep=0};n.Score.prototype.pause=function(){this.parts[this.currentPart].stop()};n.Score.prototype.loop=function(){this.looping=!0;this.start()};n.Score.prototype.noLoop=function(){this.looping=!1};n.Score.prototype.resetParts=function(){var n=this;this.parts.forEach(function(t){n.resetParts[t]})};n.Score.prototype.resetPart=function(n){this.parts[n].stop();this.parts[n].partStep=0;for(var t in this.parts[n].phrases)this.parts[n]&&(this.parts[n].phrases[t].phraseStep=0)};n.Score.prototype.setBPM=function(n,t){for(var i in this.parts)this.parts[i]&&this.parts[i].setBPM(n,t)}}(t);ai=function(){var i=t,r=v;return n.SoundLoop=function(n,t){this.callback=n;this.musicalTimeMode=typeof this._interval=="number"?!1:!0;this._interval=t||1;this._timeSignature=4;this._bpm=60;this.isPlaying=!1;this.maxIterations=Infinity;var u=this;this.clock=new r({callback:function(n){var t=n-i.audiocontext.currentTime;t>0&&u.iterations<=u.maxIterations&&u.callback(t)},frequency:this._calcFreq()})},n.SoundLoop.prototype.start=function(n){var t=n||0,r=i.audiocontext.currentTime;this.isPlaying||(this.clock.start(r+t),this.isPlaying=!0)},n.SoundLoop.prototype.stop=function(n){var t=n||0,r=i.audiocontext.currentTime;this.isPlaying&&(this.clock.stop(r+t),this.isPlaying=!1)},n.SoundLoop.prototype.pause=function(n){var t=n||0;this.isPlaying&&(this.clock.pause(t),this.isPlaying=!1)},n.SoundLoop.prototype.syncedStart=function(n,t){var u=t||0,r=i.audiocontext.currentTime,f;n.isPlaying?n.isPlaying&&(f=n.clock._nextTick-i.audiocontext.currentTime,this.clock.start(r+f),this.isPlaying=!0):(n.clock.start(r+u),n.isPlaying=!0,this.clock.start(r+u),this.isPlaying=!0)},n.SoundLoop.prototype._update=function(){this.clock.frequency.value=this._calcFreq()},n.SoundLoop.prototype._calcFreq=function(){return typeof this._interval=="number"?(this.musicalTimeMode=!1,1/this._interval):typeof this._interval=="string"?(this.musicalTimeMode=!0,this._bpm/60/this._convertNotation(this._interval)*(this._timeSignature/4)):void 0},n.SoundLoop.prototype._convertNotation=function(n){var t=n.slice(-1);n=Number(n.slice(0,-1));switch(t){case"m":return this._measure(n);case"n":return this._note(n);default:console.warn("Specified interval is not formatted correctly. See Tone.js timing reference for more info: https://github.com/Tonejs/Tone.js/wiki/Time")}},n.SoundLoop.prototype._measure=function(n){return n*this._timeSignature},n.SoundLoop.prototype._note=function(n){return this._timeSignature/n},Object.defineProperty(n.SoundLoop.prototype,"bpm",{get:function(){return this._bpm},set:function(n){this.musicalTimeMode||console.warn('Changing the BPM in "seconds" mode has no effect. BPM is only relevant in musicalTimeMode when the interval is specified as a string ("2n", "4n", "1m"...etc)');this._bpm=n;this._update()}}),Object.defineProperty(n.SoundLoop.prototype,"timeSignature",{get:function(){return this._timeSignature},set:function(n){this.musicalTimeMode||console.warn('Changing the timeSignature in "seconds" mode has no effect. BPM is only relevant in musicalTimeMode when the interval is specified as a string ("2n", "4n", "1m"...etc)');this._timeSignature=n;this._update()}}),Object.defineProperty(n.SoundLoop.prototype,"interval",{get:function(){return this._interval},set:function(n){this.musicalTimeMode=typeof n=="Number"?!1:!0;this._interval=n;this._update()}}),Object.defineProperty(n.SoundLoop.prototype,"iterations",{get:function(){return this.clock.ticks}}),n.SoundLoop}(t,v);vi=function(){"use strict";var u=t,i=r,f=s;return n.Compressor=function(){i.call(this);this.compressor=this.ac.createDynamicsCompressor();this.input.connect(this.compressor);this.compressor.connect(this.wet)},n.Compressor.prototype=Object.create(i.prototype),n.Compressor.prototype.process=function(n,t,i,r,u,f){n.connect(this.input);this.set(t,i,r,u,f)},n.Compressor.prototype.set=function(n,t,i,r,u){typeof n!="undefined"&&this.attack(n);typeof t!="undefined"&&this.knee(t);typeof i!="undefined"&&this.ratio(i);typeof r!="undefined"&&this.threshold(r);typeof u!="undefined"&&this.release(u)},n.Compressor.prototype.attack=function(n,t){var i=t||0;return typeof n=="number"?(this.compressor.attack.value=n,this.compressor.attack.cancelScheduledValues(this.ac.currentTime+.01+i),this.compressor.attack.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):typeof n!="undefined"&&n.connect(this.compressor.attack),this.compressor.attack.value},n.Compressor.prototype.knee=function(n,t){var i=t||0;return typeof n=="number"?(this.compressor.knee.value=n,this.compressor.knee.cancelScheduledValues(this.ac.currentTime+.01+i),this.compressor.knee.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):typeof n!="undefined"&&n.connect(this.compressor.knee),this.compressor.knee.value},n.Compressor.prototype.ratio=function(n,t){var i=t||0;return typeof n=="number"?(this.compressor.ratio.value=n,this.compressor.ratio.cancelScheduledValues(this.ac.currentTime+.01+i),this.compressor.ratio.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):typeof n!="undefined"&&n.connect(this.compressor.ratio),this.compressor.ratio.value},n.Compressor.prototype.threshold=function(n,t){var i=t||0;return typeof n=="number"?(this.compressor.threshold.value=n,this.compressor.threshold.cancelScheduledValues(this.ac.currentTime+.01+i),this.compressor.threshold.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):typeof n!="undefined"&&n.connect(this.compressor.threshold),this.compressor.threshold.value},n.Compressor.prototype.release=function(n,t){var i=t||0;return typeof n=="number"?(this.compressor.release.value=n,this.compressor.release.cancelScheduledValues(this.ac.currentTime+.01+i),this.compressor.release.linearRampToValueAtTime(n,this.ac.currentTime+.02+i)):typeof number!="undefined"&&n.connect(this.compressor.release),this.compressor.release.value},n.Compressor.prototype.reduction=function(){return this.compressor.reduction.value},n.Compressor.prototype.dispose=function(){i.prototype.dispose.apply(this);this.compressor.disconnect();this.compressor=undefined},n.Compressor}(t,r,s);yi=function(){function f(n,t){for(var f=n.length+t.length,i=new Float32Array(f),r=0,u=0;u<f;)i[u++]=n[r],i[u++]=t[r],r++;return i}function u(n,t,i){for(var u=i.length,r=0;r<u;r++)n.setUint8(t+r,i.charCodeAt(r))}var r=t,i=r.audiocontext;n.SoundRecorder=function(){this.input=i.createGain();this.output=i.createGain();this.recording=!1;this.bufferSize=1024;this._channels=2;this._clear();this._jsNode=i.createScriptProcessor(this.bufferSize,this._channels,2);this._jsNode.onaudioprocess=this._audioprocess.bind(this);this._callback=function(){};this._jsNode.connect(n.soundOut._silentNode);this.setInput();r.soundArray.push(this)};n.SoundRecorder.prototype.setInput=function(t){this.input.disconnect();this.input=null;this.input=i.createGain();this.input.connect(this._jsNode);this.input.connect(this.output);t?t.connect(this.input):n.soundOut.output.connect(this.input)};n.SoundRecorder.prototype.record=function(n,t,r){this.recording=!0;t&&(this.sampleLimit=Math.round(t*i.sampleRate));n&&r?this._callback=function(){this.buffer=this._getBuffer();n.setBuffer(this.buffer);r()}:n&&(this._callback=function(){this.buffer=this._getBuffer();n.setBuffer(this.buffer)})};n.SoundRecorder.prototype.stop=function(){this.recording=!1;this._callback();this._clear()};n.SoundRecorder.prototype._clear=function(){this._leftBuffers=[];this._rightBuffers=[];this.recordedSamples=0;this.sampleLimit=null};n.SoundRecorder.prototype._audioprocess=function(n){if(this.recording!==!1&&this.recording===!0)if(this.sampleLimit&&this.recordedSamples>=this.sampleLimit)this.stop();else{var t=n.inputBuffer.getChannelData(0),i=n.inputBuffer.getChannelData(1);this._leftBuffers.push(new Float32Array(t));this._rightBuffers.push(new Float32Array(i));this.recordedSamples+=this.bufferSize}};n.SoundRecorder.prototype._getBuffer=function(){var n=[];return n.push(this._mergeBuffers(this._leftBuffers)),n.push(this._mergeBuffers(this._rightBuffers)),n};n.SoundRecorder.prototype._mergeBuffers=function(n){for(var i,r=new Float32Array(this.recordedSamples),u=0,f=n.length,t=0;t<f;t++)i=n[t],r.set(i,u),u+=i.length;return r};n.SoundRecorder.prototype.dispose=function(){this._clear();var n=r.soundArray.indexOf(this);r.soundArray.splice(n,1);this._callback=function(){};this.input&&this.input.disconnect();this.input=null;this._jsNode=null};n.prototype.saveSound=function(t,i){var s,h,o;s=t.buffer.getChannelData(0);h=t.buffer.numberOfChannels>1?t.buffer.getChannelData(1):s;var e=f(s,h),l=new window.ArrayBuffer(44+e.length*2),r=new window.DataView(l);u(r,0,"RIFF");r.setUint32(4,36+e.length*2,!0);u(r,8,"WAVE");u(r,12,"fmt ");r.setUint32(16,16,!0);r.setUint16(20,1,!0);r.setUint16(22,2,!0);r.setUint32(24,44100,!0);r.setUint32(28,176400,!0);r.setUint16(32,4,!0);r.setUint16(34,16,!0);u(r,36,"data");r.setUint32(40,e.length*2,!0);var a=e.length,c=44;for(o=0;o<a;o++)r.setInt16(c,e[o]*32767,!0),c+=2;n.prototype.writeFile([r],i,"wav")}}(o,t);pi=function(){n.PeakDetect=function(n,t,i,r){this.framesPerPeak=r||20;this.framesSinceLastPeak=0;this.decayRate=.95;this.threshold=i||.35;this.cutoff=0;this.cutoffMult=1.5;this.energy=0;this.penergy=0;this.currentValue=0;this.isDetected=!1;this.f1=n||40;this.f2=t||2e4;this._onPeak=function(){}};n.PeakDetect.prototype.update=function(n){var t=this.energy=n.getEnergy(this.f1,this.f2)/255;t>this.cutoff&&t>this.threshold&&t-this.penergy>0?(this._onPeak(),this.isDetected=!0,this.cutoff=t*this.cutoffMult,this.framesSinceLastPeak=0):(this.isDetected=!1,this.framesSinceLastPeak<=this.framesPerPeak?this.framesSinceLastPeak++:(this.cutoff*=this.decayRate,this.cutoff=Math.max(this.cutoff,this.threshold)));this.currentValue=t;this.penergy=t};n.PeakDetect.prototype.onPeak=function(n,t){var i=this;i._onPeak=function(){n(i.energy,t)}}}();wi=function(){var i=t;n.Gain=function(){this.ac=i.audiocontext;this.input=this.ac.createGain();this.output=this.ac.createGain();this.input.gain.value=.5;this.input.connect(this.output);i.soundArray.push(this)};n.Gain.prototype.setInput=function(n){n.connect(this.input)};n.Gain.prototype.connect=function(t){var i=t||n.soundOut.input;this.output.connect(i.input?i.input:i)};n.Gain.prototype.disconnect=function(){this.output.disconnect()};n.Gain.prototype.amp=function(n,t,r){var t=t||0,r=r||0,u=i.audiocontext.currentTime,f=this.output.gain.value;this.output.gain.cancelScheduledValues(u);this.output.gain.linearRampToValueAtTime(f,u+r);this.output.gain.linearRampToValueAtTime(n,u+r+t)};n.Gain.prototype.dispose=function(){var n=i.soundArray.indexOf(this);i.soundArray.splice(n,1);this.output.disconnect();this.input.disconnect();this.output=undefined;this.input=undefined}}(t,o);p=function(){var i=t;return n.AudioVoice=function(){this.ac=i.audiocontext;this.output=this.ac.createGain();this.connect();i.soundArray.push(this)},n.AudioVoice.prototype._setNote=function(t){var i={A:21,B:23,C:24,D:26,E:28,F:29,G:31}[t[0]],r=typeof Number(t.slice(-1))=="number"?t.slice(-1):0;return i+=12*r,i=t[1]==="#"?i+1:t[1]==="b"?i-1:i,n.prototype.midiToFreq(i)},n.AudioVoice.prototype.play=function(){},n.AudioVoice.prototype.triggerAttack=function(){},n.AudioVoice.prototype.triggerRelease=function(){},n.AudioVoice.prototype.amp=function(){},n.AudioVoice.prototype.connect=function(n){var t=n||i.input;this.output.connect(t.input?t.input:t)},n.AudioVoice.prototype.disconnect=function(){this.output.disconnect()},n.AudioVoice.prototype.dispose=function(){this.output.disconnect();delete this.output},n.AudioVoice}(t);it=function(){var i=t,r=p;n.MonoSynth=function(){r.call(this);this.oscillator=new n.Oscillator;this.env=new n.Env;this.env.setRange(1,0);this.env.setExp(!0);this.setADSR(.02,.25,.05,.35);this.filter=new n.Filter("highpass");this.filter.set(5,1);this.oscillator.disconnect();this.oscillator.connect(this.filter);this.env.disconnect();this.env.setInput(this.oscillator);this.filter.connect(this.output);this.oscillator.start();this.connect();this._isOn=!1;i.soundArray.push(this)};n.MonoSynth.prototype=Object.create(n.AudioVoice.prototype);n.MonoSynth.prototype.play=function(n,t,i,r){var r=r||this.sustain;this.susTime=r;this.triggerAttack(n,t,i);this.triggerRelease(i+r)};n.MonoSynth.prototype.triggerAttack=function(n,t,i){var i=i||0,r=typeof n=="string"?this._setNote(n):typeof n=="number"?n:440,u=t||1;this._isOn=!0;this.oscillator.freq(r,0,i);this.env.ramp(this.output,i,u)};n.MonoSynth.prototype.triggerRelease=function(n){var n=n||0;this.env.ramp(this.output,n,0);this._isOn=!1};n.MonoSynth.prototype.setADSR=function(n,t,i,r){this.env.setADSR(n,t,i,r)};Object.defineProperties(n.MonoSynth.prototype,{attack:{get:function(){return this.env.aTime},set:function(n){this.env.setADSR(n,this.env.dTime,this.env.sPercent,this.env.rTime)}},decay:{get:function(){return this.env.dTime},set:function(n){this.env.setADSR(this.env.aTime,n,this.env.sPercent,this.env.rTime)}},sustain:{get:function(){return this.env.sPercent},set:function(n){this.env.setADSR(this.env.aTime,this.env.dTime,n,this.env.rTime)}},release:{get:function(){return this.env.rTime},set:function(n){this.env.setADSR(this.env.aTime,this.env.dTime,this.env.sPercent,n)}}});n.MonoSynth.prototype.amp=function(n,t){var i=t||0;return typeof n!="undefined"&&this.oscillator.amp(n,i),this.oscillator.amp().value};n.MonoSynth.prototype.connect=function(n){var t=n||i.input;this.output.connect(t.input?t.input:t)};n.MonoSynth.prototype.disconnect=function(){this.output.disconnect()};n.MonoSynth.prototype.dispose=function(){r.prototype.dispose.apply(this);this.filter.dispose();this.env.dispose();try{this.oscillator.dispose()}catch(n){console.error("mono synth default oscillator already disposed")}}}(t,p);rt=function(){var i=t,r=c;n.PolySynth=function(t,u){this.audiovoices=[];this.notes={};this._newest=0;this._oldest=0;this.polyValue=u||8;this.AudioVoice=t===undefined?n.MonoSynth:t;this._voicesInUse=new r(0);this.output=i.audiocontext.createGain();this.connect();this._allocateVoices();i.soundArray.push(this)};n.PolySynth.prototype._allocateVoices=function(){for(var n=0;n<this.polyValue;n++)this.audiovoices.push(new this.AudioVoice),this.audiovoices[n].disconnect(),this.audiovoices[n].connect(this.output)};n.PolySynth.prototype.play=function(n,t,i,r){var r=r||1;this.noteAttack(n,t,i);this.noteRelease(n,i+r)};n.PolySynth.prototype.noteADSR=function(n,t,r,u,f,e){var o=i.audiocontext.currentTime,e=e||0,s=o+e;this.audiovoices[this.notes[n].getValueAtTime(s)].setADSR(t,r,u,f)};n.PolySynth.prototype.setADSR=function(n,t,i,r){this.audiovoices.forEach(function(u){u.setADSR(n,t,i,r)})};n.PolySynth.prototype.noteAttack=function(t,u,f){var y=i.audiocontext.currentTime,l=f||0,e=y+l,o=typeof t=="string"?this.AudioVoice.prototype._setNote(t):typeof t=="number"?t:440,s=u===undefined?1:u,h,a,v,c;this.notes[o]!==undefined&&this.notes[o].getValueAtTime(e)!==null&&this.noteRelease(o,0);this._voicesInUse.getValueAtTime(e)<this.polyValue?h=this._voicesInUse.getValueAtTime(e):(h=this._oldest,a=n.prototype.freqToMidi(this.audiovoices[this._oldest].oscillator.freq().value),this.noteRelease(a),this._oldest=(this._oldest+1)%(this.polyValue-1));this.notes[o]=new r;this.notes[o].setValueAtTime(h,e);v=this._voicesInUse._searchBefore(e)===null?0:this._voicesInUse._searchBefore(e).value;this._voicesInUse.setValueAtTime(v+1,e);this._updateAfter(e,1);this._newest=h;typeof s=="number"&&(c=2/this._voicesInUse.getValueAtTime(e),s=s>c?c:s);this.audiovoices[h].triggerAttack(o,s,l)};n.PolySynth.prototype._updateAfter=function(n,t){if(this._voicesInUse._searchAfter(n)!==null){this._voicesInUse._searchAfter(n).value+=t;var i=this._voicesInUse._searchAfter(n).time;this._updateAfter(i,t)}};n.PolySynth.prototype.noteRelease=function(n,t){var u=typeof n=="string"?this.AudioVoice.prototype._setNote(n):typeof n=="number"?n:this.audiovoices[this._newest].oscillator.freq().value,o=i.audiocontext.currentTime,f=t||0,r=o+f,e;this.notes[u].getValueAtTime(r)===null?console.warn("Cannot release a note that is not already playing"):(e=this._voicesInUse._searchBefore(r)===null?0:this._voicesInUse._searchBefore(r).value,this._voicesInUse.setValueAtTime(e-1,r),this._updateAfter(r,-1),this.audiovoices[this.notes[u].getValueAtTime(r)].triggerRelease(f),this.notes[u].setValueAtTime(null,r),this._newest=this._newest===0?0:(this._newest-1)%(this.polyValue-1))};n.PolySynth.prototype.connect=function(n){var t=n||i.input;this.output.connect(t.input?t.input:t)};n.PolySynth.prototype.disconnect=function(){this.output.disconnect()};n.PolySynth.prototype.dispose=function(){this.audiovoices.forEach(function(n){n.dispose()});this.output.disconnect();delete this.output}}(t,c,o);bi=function(){function i(n){for(var u=typeof n=="number"?n:50,i=44100,f=new Float32Array(i),e=Math.PI/180,t=0,r;t<i;++t)r=t*2/i-1,f[t]=(3+u)*r*20*e/(Math.PI+u*Math.abs(r));return f}var t=r;n.Distortion=function(r,u){if(t.call(this),typeof r=="undefined"&&(r=.25),typeof r!="number")throw new Error("amount must be a number");if(typeof u=="undefined"&&(u="2x"),typeof u!="string")throw new Error("oversample must be a String");var f=n.prototype.map(r,0,1,0,2e3);this.waveShaperNode=this.ac.createWaveShaper();this.amount=f;this.waveShaperNode.curve=i(f);this.waveShaperNode.oversample=u;this.input.connect(this.waveShaperNode);this.waveShaperNode.connect(this.wet)};n.Distortion.prototype=Object.create(t.prototype);n.Distortion.prototype.process=function(n,t,i){n.connect(this.input);this.set(t,i)};n.Distortion.prototype.set=function(t,r){if(t){var u=n.prototype.map(t,0,1,0,2e3);this.amount=u;this.waveShaperNode.curve=i(u)}r&&(this.waveShaperNode.oversample=r)};n.Distortion.prototype.getAmount=function(){return this.amount};n.Distortion.prototype.getOversample=function(){return this.waveShaperNode.oversample};n.Distortion.prototype.dispose=function(){t.prototype.dispose.apply(this);this.waveShaperNode.disconnect();this.waveShaperNode=null}}(r);ir=function(){return o}(o,t,y,s,ut,ft,et,ot,vt,b,pt,wt,bt,kt,l,ui,fi,ei,oi,si,ci,li,ai,vi,yi,pi,wi,it,rt,bi,p,it,rt)});